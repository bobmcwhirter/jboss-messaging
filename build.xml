<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE project [
   <!ENTITY buildmagic SYSTEM "../tools/etc/buildmagic/buildmagic.ent">
   <!ENTITY libraries SYSTEM "../thirdparty/libraries.ent">
   <!ENTITY modules SYSTEM "../tools/etc/buildmagic/modules.ent">
]>

<!-- ====================================================================== -->
<!--                                                                        -->
<!--  JBoss, the OpenSource J2EE webOS                                      -->
<!--                                                                        -->
<!--  Distributable under LGPL license.                                     -->
<!--  See terms of license at http://www.gnu.org.                           -->
<!--                                                                        -->
<!-- ====================================================================== -->


<!-- $Id$ -->


<project default="main" name="JBoss/Messaging">

  <!-- ================================================================== -->
  <!-- Setup                                                              -->
  <!-- ================================================================== -->

  <!--
     | Include the common Buildmagic elements.
     |
     | This defines several different targets, properties and paths.
     | It also sets up the basic extention tasks amoung other things.
   -->

  &buildmagic;




  <!-- ================================================================== -->
  <!-- Initialization                                                     -->
  <!-- ================================================================== -->

  <!--
     | Initialize the build system.  Must depend on '_buildmagic:init'.
     | Other targets should depend on 'init' or things will mysteriously fail.
   -->

  <target name="init" unless="init.disable" depends="_buildmagic:init">
  </target>


  <!-- ================================================================== -->
  <!-- Configuration                                                      -->
  <!-- ================================================================== -->

  <!--
     | Configure the build system.
     |
     | This target is invoked by the Buildmagic initialization logic and
     | should contain module specific configuration elements.
   -->

  <target name="configure" unless="configure.disable">

    <!-- =================== -->
    <!-- Basic Configuration -->
    <!-- =================== -->

     <property name="messaging.version.major" value="1"/>
     <property name="messaging.version.minor" value="0"/>
     <property name="messaging.version.revision" value="0"/>
     <property name="messaging.version.incrementing" value="1"/>
     <property name="messaging.version.tag" value="alpha-PR2.2"/>
     <property name="messaging.version.name" value=""/>
     <!-- This must be set to the CVS tag for any release -->
     <property name="messaging.version.cvstag" value="JBossMessaging_1_0_0_alpha_PR2_2"/>

     <!-- Module name(s) & version -->
     <property name="module.name" value="messaging"/>
     <property name="module.Name" value="JBoss Messaging"/>
     <property name="module.version" value="${messaging.version.major}.${messaging.version.minor}.${messaging.version.revision}${messaging.version.tag}"/>


     <!-- Manifest version info -->
     <property name="messaging.specification.title" value="${module.Name}"/>
     <property name="messaging.specification.version" value="${messaging.version.major}.${messaging.version.minor}.${messaging.version.revision}"/>
     <property name="messaging.specification.vendor" value="JBoss (http://www.jboss.org/)"/>

     <property name="messaging.implementation.title" value="${module.Name}"/>
     <property name="messaging.implementation.url" value="http://www.jboss.org/"/>
     <property name="messaging.implementation.version"
        value="${messaging.version.major}.${messaging.version.minor}.${messaging.version.revision}${messaging.version.tag} (build: CVSTag=${messaging.version.cvstag} date=${build.id})"/>
     <property name="messaging.implementation.vendor" value="JBoss Inc."/>
     <property name="messaging.implementation.vendor.id" value="${implementation.url}"/>

     <property name="jms.version.major" value="1"/>
     <property name="jms.version.minor" value="1"/>
     <property name="jms.version" value="1.1"/>

    <!-- ========= -->
    <!-- Libraries -->
    <!-- ========= -->

    &libraries;


    <!-- The combined library classpath -->
    <path id="library.classpath">
       <path refid="apache.commons.classpath"/>
       <path refid="oswego.concurrent.classpath"/>
       <path refid="javassist.classpath"/>
       <path refid="jgroups.jgroups.classpath"/>
       <path refid="junit.junit.classpath"/>
       <path refid="gnu.regexp.classpath"/>
       <path refid="trove.trove.classpath"/>
    </path>


    <!-- ======= -->
    <!-- Modules -->
    <!-- ======= -->

     &modules;

     <!-- The combined dependent module classpath -->
     <path id="dependentmodule.classpath">
        <path refid="jboss.common.classpath"/>
        <path refid="jboss.j2ee.classpath"/>
        <path refid="jboss.remoting.classpath"/>
        <path refid="jboss.serialization.classpath"/>
        <path refid="jboss.aop.classpath"/>
        <path refid="jboss.aspects.classpath"/>
        <path refid="jboss.j2se.classpath"/>
        <path refid="jboss.system.classpath"/>
        <path refid="jboss.security.classpath"/>
        <path refid="jboss.server.classpath"/>
        <path refid="jboss.transaction.classpath"/>

        <!-- If I don't use directly UnifiedClassLoader3, this should go away -->
        <path refid="jboss.jmx.classpath"/>
     </path>

    <!-- ===== -->
    <!-- Tasks -->
    <!-- ===== -->

    <!-- Where source files live -->
    <property name="source.java" value="${module.source}/main"/>
    <property name="source.etc" value="${module.source}/etc"/>

    <!-- Where build generated files will go -->
    <property name="build.reports" value="${module.output}/reports"/>
    <property name="build.classes" value="${module.output}/classes"/>
    <property name="build.lib" value="${module.output}/lib"/>
    <property name="build.api" value="${module.output}/api"/>
    <property name="build.etc" value="${module.output}/etc"/>
    <property name="build.gen-src" value="${module.output}/gen-src"/>
    <property name="build.gen" value="${module.output}/gen"/>
    <property name="build.parsers" value="${module.output}/parsers"/>
    <property name="build.perfsar" value="${module.output}/perfsar"/>

    <!-- Install/Release structure -->
    <property name="install.id" value="${module.name}-${module.version}"/>
    <property name="release.id" value="${install.id}"/>
    <property name="install.root" value="${module.output}/${install.id}"/>
    <property name="install.root" value="${module.output}/${install.id}"/>

    <!-- The combined thirdparty classpath -->
    <path id="thirdparty.classpath">
      <path refid="library.classpath"/>
      <path refid="dependentmodule.classpath"/>
    </path>

    <!-- RMIC should generate stubs compatible with Java 1.2+ -->
    <property name="rmic.stubVersion" value="1.2"/>

    <!-- classpath and local.classpath must have a value using with a path -->
    <property name="classpath" value=""/>
    <property name="local.classpath" value=""/>

    <!-- The classpath required to build classes. -->
    <path id="javac.classpath">
      <pathelement path="${classpath}"/>
      <pathelement path="${local.classpath}"/>
      <path refid="thirdparty.classpath"/>
    </path>

    <path id="aopc.classpath">
       <path refid="javac.classpath"/>
       <pathelement path="${build.classes}"/>
    </path>

    <!-- The classpath required to build javadocs. -->
    <path id="javadoc.classpath">
      <path refid="javac.classpath"/>
    </path>

    <!-- xdoclet -->
    <path id="xdoclet.task.classpath">
      <path refid="javac.classpath"/>
      <path refid="apache.commons.classpath"/>
      <fileset dir="${xdoclet.xdoclet.lib}">
        <include name="**/*.jar"/>
      </fileset>
    </path>
    <property name="xdoclet.task.classpath"
          refid="xdoclet.task.classpath"/>

    <!-- Packages to include when generating api documentation -->
    <property name="javadoc.packages" value="org.jboss.jms.*"/>

    <!-- Override JUnit defaults -->
    <property name="junit.timeout" value="240000"/> <!-- 4 minutes -->
    <property name="junit.batchtest.todir" value="${build.reports}"/>
    <property name="junit.jvm.options" value="-Ddummy"/>

     <!-- ==================== -->
     <!-- Local path overrides -->
     <!-- ==================== -->

     <!--
         Sometimes I need to locally patch a library and use the local version (src/resources),
         until the change makes it to thridpary. This is how you can locally override a library.
         To use the thirdparty library, just uncoment the standard definition of the "common.."
         propery and comment out the localized definitions below.
      -->

     <!-- JBoss Remoting -->

<!--
     <property name="current.jboss.remoting.lib" value="${jboss.remoting.lib}"/>
-->

     <property name="current.jboss.remoting.lib" value="${module.root}/src/resources"/>
     <path id="jboss.remoting.classpath">
        <pathelement path="${module.root}/src/resources/jboss-remoting.jar"/>
     </path>

     <property name="current.jboss.serialization.lib" value="${module.root}/src/resources"/>
     <path id="jboss.serialization.classpath">
         <pathelement path="${module.root}/src/resources/jboss-serialization.jar"/>
     </path>



     <!-- JGroups -->

     <!--
     <path id="jgroups.jgroups.classpath">
     <pathelement path="${module.root}/src/resources/jgroups-core.jar"/>
     </path>
     -->


  </target>


  <!-- ================================================================== -->
  <!-- Compile                                                            -->
  <!-- ================================================================== -->

  <!--
     | Compile everything.
     |
     | This target should depend on other compile-* targets for each
     | different type of compile that needs to be performed, short of
     | documentation compiles.
   -->

  <target name="compile"
      description="Compile all source files."
      depends="compile-parsers, compile-classes, compile-etc"/>

    <!-- Compile parsers -->
  <target name="compile-parsers" depends="init">
    <mkdir dir="${build.parsers}/org/jboss/jms/selector"/>

    <!-- message selector parser -->
    <javacc target="${source.java}/org/jboss/jms/selector/SelectorParser.jj"
            outputdirectory="${build.parsers}/org/jboss/jms/selector"
            javacchome="${sun.javacc.lib}"
            static="false"/>

    <!-- compile them now -->
    <mkdir dir="${build.classes}"/>
    <javac destdir="${build.classes}"
           optimize="${javac.optimize}"
           target="${javac.target}"
           source="${javac.source}"
           debug="${javac.debug}"
           depend="${javac.depend}"
           verbose="${javac.verbose}"
           deprecation="${javac.deprecation}"
           includeAntRuntime="${javac.include.ant.runtime}"
           includeJavaRuntime="${javac.include.java.runtime}"
           failonerror="${javac.fail.onerror}">
       <classpath refid="javac.classpath"/>

       <!-- JavaCC creates output in a flat namespace -->
       <src path="${build.parsers}"/>
       <!--
       <include name="*.java"/>
    -->
       <!-- Only want to build required the bits under selectors.* here -->
       <src path="${source.java}"/>
       <include name="org/jboss/jms/selector/ASCII_CharStream.java"/>
       <include name="org/jboss/jms/selector/ParserException.java"/>
       <include name="org/jboss/jms/selector/SelectorParser.java"/>
       <include name="org/jboss/jms/selector/SelectorParserConstants.java"/>
       <include name="org/jboss/jms/selector/SelectorParserTokenManager.java"/>
       <include name="org/jboss/jms/selector/Token.java"/>
       <include name="org/jboss/jms/selector/TokenMgrError.java"/>
       <include name="org/jboss/jms/selector/Operator.java"/>
       <include name="org/jboss/jms/selector/Identifier.java"/>
    </javac>
  </target>

  <!-- Compile all class files -->
   <target name="compile-classes" depends="init">
      <mkdir dir="${build.classes}"/>
      <javac destdir="${build.classes}"
         optimize="${javac.optimize}"
         target="${javac.target}"
         source="${javac.source}"
         debug="${javac.debug}"
         depend="${javac.depend}"
         verbose="${javac.verbose}"
         deprecation="${javac.deprecation}"
         includeAntRuntime="${javac.include.ant.runtime}"
         includeJavaRuntime="${javac.include.java.runtime}"
         failonerror="${javac.fail.onerror}">
         <src path="${source.java}"/>
         <classpath refid="javac.classpath"/>
         <include name="${javac.includes}"/>
         <exclude name="${javac.excludes}"/>
      </javac>
      <taskdef name="aopc" classname="org.jboss.aop.ant.AopC"
         classpathref="jboss.aop.classpath"/>
      <aopc compilerclasspathref="aopc.classpath" classpathref="aopc.classpath" verbose="false">
         <classpath refid="aopc.classpath"/>
         <src path="${build.classes}"/>
         <aoppath path="src/etc/prepare-aop.xml"/>
      </aopc>
   </target>

  <!-- Compile manifests -->
  <target name="compile-etc" depends="init">
    <mkdir dir="${build.etc}"/>
    <copy todir="${build.etc}" filtering="yes">
      <fileset dir="${source.etc}">
         <include name="**"/>
      </fileset>
       <filterset>
          <filter token="JMS_VERSION" value="${jms.version}"/>
          <filter token="JMS_VERSION_MAJOR" value="${jms.version.major}"/>
          <filter token="JMS_VERSION_MINOR" value="${jms.version.minor}"/>
          <filter token="MODULE_VERSION" value="${module.version}"/>
          <filter token="MESSAGING_VERSION_MAJOR" value="${messaging.version.major}"/>
          <filter token="MESSAGING_VERSION_MINOR" value="${messaging.version.minor}"/>
          <filter token="MESSAGING_VERSION_INCREMENTING" value="${messaging.version.incrementing}"/>
          <filter token="MODULE_NAME" value="${module.Name}"/>
       </filterset>
    </copy>
    <move file="${build.etc}/VERSION-PRE-SUBSTITUTE" toFile="${build.etc}/VERSION"/>
  </target>


  <!-- ================================================================== -->
  <!-- Archives                                                           -->
  <!-- ================================================================== -->

   <!--
   | Build all jar files.
   -->
   <target name="jars" description="Builds all jar files."
      depends="_buildmagic:build-bypass-check"
      unless="build-bypass.on">

      <call target="compile"/>

      <mkdir dir="${build.lib}"/>

      <!-- Build the jboss-${module.name}.jar -->
      <jar jarfile="${build.lib}/jboss-${module.name}.jar"
         manifest="${build.etc}/default.mf">
         <fileset dir="${build.classes}">
            <!-- Include everything else -->
            <include name="org/jboss/**"/>
            <include name="VERSION"/>
            <exclude name="org/jboss/jms/perf/**"/>
         </fileset>
      </jar>

      <!-- Update the build marker to allow bypassing -->
      <touch file="${build-bypass.marker}"/>

   </target>

  <!-- ================================================================== -->
  <!-- Install & Release                                                  -->
  <!-- ================================================================== -->

  <target name="dist" depends="javadocs">
  </target>

  <target name="install"
      description="Install the structure for a release."
      depends="all, _buildmagic:install:default">

      <mkdir dir="${module.source}/bin"/>

      <filter token="module.name" value="${module.name}"/>
      <copy todir="${install.root}/bin" filtering="yes">
          <fileset dir="${module.source}/bin"/>
      </copy>
      <chmod dir="${install.root}/bin" perm="ugo+rx" includes="**/*.sh"/>

      <copy todir="${install.root}/lib" filtering="no">
            <fileset dir="${jboss.j2ee.lib}">
                <include name="jboss-j2ee.jar"/>
            </fileset>
            <fileset dir="${jboss.common.lib}">
                <include name="jboss-common.jar"/>
            </fileset>
            <fileset dir="${apache.log4j.lib}">
                <include name="log4j.jar"/>
            </fileset>
            <fileset dir="${apache.commons.lib}">
                <include name="commons-logging.jar"/>
            </fileset>
            <fileset dir="${jgroups.jgroups.lib}">
                <include name="jgroups.jar"/>
            </fileset>
      </copy>
  </target>

  <target name="release" depends="install"/>

  <target name="release-zip"
      description="Builds a ZIP distribution."
      depends="release, _buildmagic:release:zip"/>

  <target name="release-tar"
      description="Builds a TAR distribution."
      depends="release, _buildmagic:release:tar"/>

  <target name="release-tgz"
      description="Builds a TAR-GZ distribution."
      depends="release, _buildmagic:release:tgz"/>

  <target name="release-all"
      description="Builds a distribution for each archive type."
      depends="release-zip, release-tgz"/>


  <!-- ================================================================== -->
  <!-- Cleaning                                                           -->
  <!-- ================================================================== -->

  <!-- Clean up all build output -->
  <target name="clean"
      description="Cleans up most generated files."
      depends="_buildmagic:clean">

      <ant dir="./docs/examples/queue" antfile="build.xml" inheritAll="false" target="clean"/>
      <ant dir="./docs/examples/topic" antfile="build.xml" inheritAll="false" target="clean"/>
      <ant dir="./docs/examples/mdb" antfile="build.xml" inheritAll="false" target="clean"/>
      <ant dir="./tests" antfile="build.xml" inheritAll="false" target="clean"/>
      <ant dir="./perf" antfile="build.xml" inheritAll="false" target="clean"/>
  </target>

  <!-- Clean up all generated files -->
  <target name="clobber"
      description="Cleans up all generated files."
      depends="_buildmagic:clobber, clean">
  </target>


  <!-- ================================================================== -->
  <!-- Misc.                                                              -->
  <!-- ================================================================== -->

  <target name="main" depends="most"
      description="Executes the default target (most)."/>

  <target name="all" depends="jars, docs"
      description="Builds everything."/>

  <target name="most" depends="jars"
      description="Builds almost everything."/>

  <target name="help"
          description="Show this help message."
      depends="_buildmagic:help:standard"/>

   <target name="display-path" depends="init">
      <pathconvert refid="dependentmodule.classpath" targetos="unix" property="path.representation"/>
      <echo message="${path.representation}"/>
   </target>

   <!-- Messaging-specific tasks -->

   <property environment="ENV"/>

   <!-- Release tasks -->

   <target name="sar-structure" depends="compile">

      <mkdir dir="${build.lib}"/>
      <mkdir dir="${build.classes}/META-INF"/>
      <mkdir dir="${build.classes}/xmdesc"/>

      <copy file="${source.etc}/server/default/deploy/jboss-messaging-service.xml"
         tofile="${build.classes}/META-INF/jboss-service.xml"/>

      <copy file="${build.etc}/VERSION-PRE-SUBSTITUTE" toFile="${build.classes}/VERSION"/>

      <!-- copy all other deployment descriptors from ${source.etc}/server/default/deploy -->
      <copy todir="${build.classes}">
         <fileset dir="${source.etc}/server/default/deploy/"
            includes="*.xml"
            excludes="jboss-messaging-service.xml"/>
      </copy>

      <copy todir="${build.classes}/xmdesc">
         <fileset dir="${source.etc}/xmdesc" includes="*.xml"/>
      </copy>
      <copy todir="${build.classes}" file="${source.etc}/aop-messaging-server.xml"/>
      <copy todir="${build.classes}" file="${source.etc}/aop-messaging-client.xml"/>
   </target>

   <!-- Create a non-scoped sar that relies on dependencies from default/lib -->
   <target name="sar" depends="sar-structure">
      <jar jarfile="${build.lib}/jboss-${module.name}.sar"
         manifest="${build.etc}/default.mf">
         <fileset dir="${build.classes}">
            <include name="**"/>
            <exclude name="org/jboss/jms/perf/**"/>
         </fileset>
      </jar>
   </target>

   <!-- Create a scoped sar ready to be deployed under a JBoss 4 (and JBoss 5) instance -->
   <target name="sar-scoped" depends="sar-structure">

      <fail message="Fix the build script to correctly define 'current.jboss.remoting.lib'!"
         unless="current.jboss.remoting.lib"/>

      <!-- copy dependencies that are not available, are obsolete or need to be scoped in JBoss 4 -->

      <copy file="${jboss.aop.lib}/jboss-aop.jar" todir="${build.classes}"/>
      <copy file="${jboss.aspects.lib}/jboss-aspect-library.jar" todir="${build.classes}"/>
      <copy file="${current.jboss.remoting.lib}/jboss-remoting.jar" todir="${build.classes}"/>
      <copy file="${current.jboss.serialization.lib}/jboss-serialization.jar" todir="${build.classes}"/>
      <copy file="${javassist.javassist.lib}/javassist.jar" todir="${build.classes}"/>
      <copy file="${trove.trove.lib}/trove.jar" todir="${build.classes}"/>

      <mkdir dir="${build.classes}/tmp"/>
      <!-- I need InvocationMarshaller both on server and client side, and versions prior to
           JBoss 4.0.3 don't have them, so I need to include them as well. I only need to extract
           org.jboss.invocation.unified.marshall from jboss.jar, because otherwise I scope classes
           like javaURLContextFactory, which will mess up JNDI and other things.
      -->
      <unjar src="${jboss.server.lib}/jboss.jar"
         dest="${build.classes}/tmp">
         <patternset>
            <include name="org/jboss/invocation/unified/**"/>
         </patternset>
      </unjar>
      <jar jarfile="${build.classes}/jboss-unified-invoker.jar">
         <fileset dir="${build.classes}/tmp">
            <include name="**"/>
         </fileset>
      </jar>
      <delete>
         <fileset dir="${build.classes}/tmp" includes="**"/>
      </delete>
      <!-- I also need org.jboss.util.stream.* -->
      <unjar src="${jboss.common.lib}/jboss-common.jar"
         dest="${build.classes}/tmp">
         <patternset>
            <include name="org/jboss/util/stream/**"/>
         </patternset>
      </unjar>
      <jar jarfile="${build.classes}/jboss-common-stream.jar">
         <fileset dir="${build.classes}/tmp">
            <include name="**"/>
         </fileset>
      </jar>
      <delete dir="${build.classes}/tmp"/>

      <copy todir="${build.classes}" file="${source.etc}/server/default/config/users.properties"/>
      <copy todir="${build.classes}" file="${source.etc}/server/default/config/roles.properties"/>

      <!-- enable scoping -->
      <replaceregexp file="${build.classes}/META-INF/jboss-service.xml" flags="s">
         <regexp pattern="\x3c!\x2d-([ \t\n\r]*)(\x3cloader-repository\x3e.*\x3c/loader-repository\x3e)([ \t\n\r]*)\x2d-\x3e"/>
         <substitution expression="\2"/>
      </replaceregexp>

      <!-- enable the deployment of the remoting Connector and NeworkRegistry -->
      <replaceregexp file="${build.classes}/META-INF/jboss-service.xml" flags="s">
         <regexp pattern="\x3c!\x2d-([ \t\n\r]*)(\x3cmbean code=\x22org.jboss.remoting.transport.Connector.+NetworkRegistry\x22/\x3e)([ \t\n\r]*)\x2d-\x3e"/>
         <substitution expression="\2"/>
      </replaceregexp>

      <!-- change Connector dependency -->
      <replaceregexp file="${build.classes}/META-INF/jboss-service.xml">
         <regexp pattern="jboss.remoting:service=Connector,transport=socket"/>
         <substitution expression="jboss.messaging:service=Connector,transport=socket"/>
      </replaceregexp>

      <jar jarfile="${build.lib}/jboss-${module.name}-scoped.sar"
         manifest="${build.etc}/default.mf">
         <fileset dir="${build.classes}">
            <include name="**"/>
         </fileset>
      </jar>
   </target>

   <target name="release-structure" depends="init">
      <property name="release.output"
         value="${module.output}/release/JBossMessaging-${module.version}"/>
      <mkdir dir="${release.output}/src"/>
      <mkdir dir="${release.output}/examples"/>
   </target>

   <target name="source" depends="release-structure">
      <copy todir="${release.output}/src">
         <fileset dir="${source.java}">
            <exclude name="**/CVS"/>
         </fileset>
      </copy>
   </target>

   <target name="source-zip" depends="source">
      <zip destfile="${release.output}/JBossMessaging-${module.version}-src.zip"
         basedir="${release.output}/src"/>
   </target>

   <target name="examples" depends="release-structure">

      <!-- Make sure examples compile -->
      <ant dir="./docs/examples/queue" target="compile"/>
      <ant dir="./docs/examples/queue" target="clean"/>

      <copy todir="${release.output}/examples">
         <fileset dir="./docs/examples">
            <exclude name="mdb"/>
         </fileset>
      </copy>
   </target>

   <target name="release-bundle"
      depends="release-structure, sar-scoped, source, source-zip, examples">

      <copy todir="${release.output}" file="${build.lib}/jboss-${module.name}-scoped.sar"/>
      <copy todir="${release.output}" file="./docs/README.html"/>

      <zip destfile="${build.lib}/JBossMessaging-${module.version}.zip"
         basedir="${module.output}/release"/>
      <echo message="Release bundle JBossMessaging-${module.version}.zip done"/>
   </target>

   <target name="deployscoped" depends="sar-scoped">
         <copy file="${build.lib}/jboss-${module.name}-scoped.sar"
            todir="${ENV.JBOSS_HOME}/server/default/deploy"/>
   </target>

   <!-- CTS deployment/undeployment -->

   <target name="deploydefault" depends="sar">
      <copy file="${build.lib}/jboss-${module.name}.sar"
         todir="${ENV.JBOSS_HOME}/server/default/deploy"/>
   </target>

   <target name="undeploydefault" depends="init">
      <delete file="${ENV.JBOSS_HOME}/server/default/deploy/jboss-${module.name}.sar"/>
   </target>

   <target name="deploy" depends="sar">
      <copy file="${build.lib}/jboss-${module.name}.sar"
         todir="${ENV.JBOSS_HOME}/server/cts-messaging/deploy"/>
   </target>

   <target name="undeploy" depends="init">
      <delete file="${ENV.JBOSS_HOME}/server/cts-messaging/deploy/jboss-${module.name}.sar"/>
   </target>

   <target name="test">
   </target>

   <target name="smoke">
      <ant dir="tests/smoke" antfile="build.xml" target="smoke-test" inheritAll="false"/>
   </target>


   <!-- TODO Move all the perf related stuff to own build.xml and separate out into sub project -->

   <target name="perf-sar-structure-messaging" depends="compile">
      <mkdir dir="${build.lib}"/>
      <mkdir dir="${build.perfsar}/META-INF"/>
      <mkdir dir="${build.perfsar}/xmdesc"/>
      <copy file="${source.java}/org/jboss/jms/perf/framework/PerfRunner-xmbean.xml" tofile="${build.perfsar}/xmdesc/PerfRunner-xmbean.xml"/>
      <copy file="${source.java}/org/jboss/jms/perf/framework/jboss-service-jbossmessaging.xml" tofile="${build.perfsar}/META-INF/jboss-service.xml"/>
      <copy file="${module.source}/../tests/bin/perf-jndi.properties" tofile="${build.perfsar}/perf-jndi.properties"/>
      <copy file="${module.source}/../tests/bin/jbossmessaging-perf.properties" tofile="${build.perfsar}/perf.properties"/>
      <copy todir="${build.perfsar}"> <fileset dir="${build.classes}"> <include name="**/jms/perf/**/*.class"/> </fileset> </copy>
   </target>


   <target name="perf-sar-messaging" depends="perf-sar-structure-messaging">
      <jar jarfile="${build.lib}/jboss-perf-messaging.sar" manifest="${build.etc}/default.mf">
          <fileset dir="${build.perfsar}">
             <include name="**"/>
          </fileset>
      </jar>
   </target>

   <target name="perf-sar-structure-mq" depends="compile">
      <mkdir dir="${build.lib}"/>
      <mkdir dir="${build.perfsar}/META-INF"/>
      <mkdir dir="${build.perfsar}/xmdesc"/>
      <copy file="${source.java}/org/jboss/jms/perf/framework/PerfRunner-xmbean.xml" tofile="${build.perfsar}/xmdesc/PerfRunner-xmbean.xml"/>
      <copy file="${source.java}/org/jboss/jms/perf/framework/jboss-service-jbossmq.xml" tofile="${build.perfsar}/META-INF/jboss-service.xml"/>
      <copy file="${module.source}/../tests/bin/perf-jndi.properties" tofile="${build.perfsar}/perf-jndi.properties"/>
      <copy file="${module.source}/../tests/bin/jbossmq-perf.properties" tofile="${build.perfsar}/perf.properties"/>
      <copy todir="${build.perfsar}">
         <fileset dir="${build.classes}">
            <include name="**/jms/perf/**/*.class"/>
         </fileset>
      </copy>
   </target>


   <target name="perf-sar-mq" depends="perf-sar-structure-mq">
      <jar jarfile="${build.lib}/jboss-perf-mq.sar" manifest="${build.etc}/default.mf">
         <fileset dir="${build.perfsar}">
            <include name="**"/>
         </fileset>
      </jar>
   </target>

</project>





