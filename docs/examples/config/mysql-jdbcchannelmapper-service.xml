<?xml version="1.0" encoding="UTF-8"?>

<!-- mysql-jdbcchannelmapper-service.xml,v 1.1 2006/03/28 14:26:15 timfox Exp -->

<server>

  <loader-repository>jboss.messaging:loader=ScopedLoaderRepository
       <loader-repository-config>java2ParentDelegation=false</loader-repository-config>
  </loader-repository>

  <mbean code="org.jboss.jms.server.plugin.JDBCChannelMapper"
        name="jboss.messaging:service=ChannelMapper"
        xmbean-dd="xmdesc/JDBCChannelMapper-xmbean.xml">
        <depends>jboss.jca:service=DataSourceBinding,name=DefaultDS</depends>
        <depends optional-attribute-name="TransactionManager">jboss:service=TransactionManager</depends>
        <attribute name="DataSource">java:/DefaultDS</attribute>
        <attribute name="SqlProperties"><![CDATA[
  CREATE_USER_TABLE=CREATE TABLE JMS_USER (USERID VARCHAR(32) NOT NULL, PASSWD VARCHAR(32) NOT NULL, CLIENTID VARCHAR(128), PRIMARY KEY(USERID))
  CREATE_ROLE_TABLE=CREATE TABLE JMS_ROLE (ROLEID VARCHAR(32) NOT NULL, USERID VARCHAR(32) NOT NULL, PRIMARY KEY(USERID, ROLEID))
  SELECT_PRECONF_CLIENTID=SELECT CLIENTID FROM JMS_USER WHERE USERID=?
  CREATE_MAPPING_TABLE=CREATE TABLE JMS_CHANNEL_MAPPING (ID BIGINT, TYPE CHAR(1), JMS_DEST_NAME VARCHAR(1024), JMS_SUB_NAME VARCHAR(1024), CLIENT_ID VARCHAR(128), SELECTOR VARCHAR(1024), NO_LOCAL CHAR(1), PRIMARY KEY(ID))
  INSERT_MAPPING=INSERT INTO JMS_CHANNEL_MAPPING (ID, TYPE, JMS_DEST_NAME, JMS_SUB_NAME, CLIENT_ID, SELECTOR, NO_LOCAL) VALUES (?, ?, ?, ?, ?, ?, ?)
  DELETE_MAPPING=DELETE FROM JMS_CHANNEL_MAPPING WHERE ID = ?
  SELECT_ID_FOR_DESTINATION=SELECT ID FROM JMS_CHANNEL_MAPPING WHERE TYPE=? AND JMS_DEST_NAME=?
  SELECT_DURABLE_SUB=SELECT JMS_DEST_NAME, ID, SELECTOR, NO_LOCAL FROM JMS_CHANNEL_MAPPING WHERE CLIENT_ID=? AND JMS_SUB_NAME=?
  SELECT_SUBSCRIPTIONS_FOR_TOPIC=SELECT ID, CLIENT_ID, JMS_SUB_NAME, SELECTOR, NO_LOCAL FROM JMS_CHANNEL_MAPPING WHERE TYPE='D' AND JMS_DEST_NAME=?
        ]]></attribute>
   </mbean>

</server>