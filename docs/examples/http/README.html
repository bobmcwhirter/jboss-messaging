<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta content="text/html; charset=ISO-8859-1"
        http-equiv="content-type">
  <title>JBoss Messaging Example - HTTP Transport</title>
</head>
<body>
<br>
<h1>JBoss Messaging HTTP Transport Example</h1>
$Revision$
<h2>Overview</h2>
<p>
This example shows how to configure a ConnectionFactory to send
messages using the HTTP protocol. The example will use
such a ConnectionFactory to create two JMS connections: the first one
to send a message to the queue and the second one to read the message
from the queue. In both cases, the message will be sent over
an HTTP connection. The example is considered successful
if the client receives without any error the message that was
previously sent to the queue.</p>
<p>
This example needs to have access to a running JBoss Messaging
instance.
The JBoss Messaging instance must be installed and started according to
the
"Installation" paragraph from the release documentation. However, the
example will automatically deploy its own queue, unless a queue with
the same name is already deployed.
</p>
<h3 style="margin-left: 40px;">Warning</h3>
<div style="margin-left: 40px;">A service configuration bug that exists
in all JBoss versions prior to 4.0.4.RC1 prevents this example from
working correctly. You shouldn't attempt to run this example with JBoss
4.0.3.SP1 or lower, unless the patch corresponding to the JIRA issue
http://jira.jboss.org/jira/browse/JBAS-1709 was applied to your
installation. The bug has been fixed since JBoss 4.0.4.RC1.<br>
<span style="font-style: italic;"></span></div>
<br>
This example also needs to have access to <span
 style="font-family: monospace;">jboss-messaging-client.jar</span>
archive that comes with the release bundle. If you run this example
from an unzipped installation bundle, the example run script is
correctly configured to find the client jar. Otherwise, you must modify
example's <span style="font-family: monospace;">build.xml</span>
accordingly.<br>
<br>
<br>
<h2>Running the example</h2>
1. Set up the JBOSS_HOME environment variable to point to the JBoss
instance you deployed JBoss Messaging into. For example, if you
deployed JBoss Messaging in <span style="font-family: monospace;">C:\jboss-4.2.0.GA\server\messaging\deploy,</span>
then your JBOSS_HOME value should be <span
 style="font-family: monospace;">C:\jboss-4.2.0.GA</span><br>
<br>
2. Go to the example's home directory<br>
<br>
<div style="margin-left: 40px;"><br>
</div>
<table
 style="width: 90%; text-align: left; font-family: monospace; margin-left: 40px; background-color: rgb(255, 255, 255);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;"><br>
&nbsp;&nbsp; <span style="font-family: monospace;">cd
...\examples\secure-socket</span><br>
      <br>
      </td>
    </tr>
  </tbody>
</table>
<span style="font-family: monospace;"></span><br>
3. Run the example:<br>
<br>
<div style="margin-left: 40px;"><br>
</div>
<table
 style="width: 90%; text-align: left; font-family: monospace; margin-left: 40px; background-color: rgb(255, 255, 255);"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;"><br>
&nbsp;&nbsp; <span style="font-family: monospace;">ant</span><br>
      <br>
      </td>
    </tr>
  </tbody>
</table>
<div style="margin-left: 40px;"><br>
</div>
<br>
The output of a successful run should be similar to:<br>
<div style="margin-left: 40px;"><br>
</div>
<table
 style="width: 90%; text-align: left; font-family: monospace; background-color: rgb(204, 204, 204); margin-left: 40px;"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">
<pre>
$ ant
Buildfile: build.xml

identify:
     [echo] ############################################################################
     [echo] #                         Running the HTTP example                         #
     [echo] ############################################################################
     [echo] The queue:      testQueue
     [echo] The client jar: ../../../output/lib/jboss-messaging-client.jar

sanity-check:

init:
    [mkdir] Created dir: C:\java\messaging\docs\examples\http\output\classes
    [mkdir] Created dir: C:\java\messaging\docs\examples\common\output\classes

compile:
    [javac] Compiling 5 source files to C:\java\messaging\docs\examples\common\output\classes
    [javac] Compiling 1 source file to C:\java\messaging\docs\examples\http\output\classes

deploy:
     [copy] Copying 1 file to C:\jboss-4.2.0.GA\server\messaging\deploy

sleep:
     [echo] Sleeping for 10 seconds ...

run:
     [java] Queue /queue/testQueue exists
     [java] The message was successfully sent to the testQueue queue
     [java] Received message: Hello!
     [java] The example connected to JBoss Messaging version 1.3.0.GA (1.3)
     [java] 
     [java] #####################
     [java] ###    SUCCESS!   ###
     [java] #####################

undeploy:
   [delete] Deleting: C:\jboss-4.2.0.GA\server\messaging\deploy\messaging-http-service.xml

BUILD SUCCESSFUL
Total time: 14 seconds</pre>
      </td>
    </tr>
  </tbody>
</table>
<div style="margin-left: 40px;"><br>
</div>
<br>
<h2>Configuration details</h2>
<br>
The example client looks up a specially-configured connection factory (<span
 style="font-family: monospace;">"/HttpConnectionFactory"</span>)
that is deployed by the example run script. The HTTP
ConnectionFactory relies on a HTTP Remoting Connector to provide
the connection. The definition of the required services is
specified in the <span style="font-family: monospace;">etc/messaging-http-service.xml
</span>deployment descriptor. The deployment descriptor, as used by the
example, is listed below.<br>
<br>
<br>
<div style="margin-left: 40px;"><br>
</div>
<table
 style="width: 90%; text-align: left; font-family: monospace; background-color: rgb(204, 204, 204); margin-left: 40px;"
 border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">
<pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;

&lt;!--
     HTTP Transport Example.

     $Id$
 --&gt;

&lt;server&gt;

   &lt;mbean code="org.jboss.remoting.transport.Connector"
          name="jboss.messaging:service=Connector,transport=http"
          display-name="HTTP transport Connector"&gt;
      &lt;attribute name="Configuration"&gt;
         &lt;config&gt;
            &lt;invoker transport="http"&gt;
               &lt;attribute name="marshaller" isParam="true"&gt;org.jboss.jms.wireformat.JMSWireFormat&lt;/attribute&gt;
               &lt;attribute name="unmarshaller" isParam="true"&gt;org.jboss.jms.wireformat.JMSWireFormat&lt;/attribute&gt;
               &lt;attribute name="dataType" isParam="true"&gt;jms&lt;/attribute&gt;
               &lt;attribute name="serverBindAddress"&gt;${jboss.bind.address}&lt;/attribute&gt;
               &lt;attribute name="serverBindPort"&gt;4458&lt;/attribute&gt;
               &lt;attribute name="leasePeriod"&gt;10000&lt;/attribute&gt;
               &lt;attribute name="callbackStore"&gt;org.jboss.remoting.callback.CallbackStore&lt;/attribute&gt;
               &lt;attribute name="callbackPollPeriod" isParam="true"&gt;100&lt;/attribute&gt;
            &lt;/invoker&gt;
            &lt;handlers&gt;
               &lt;handler subsystem="JMS"&gt;org.jboss.jms.server.remoting.JMSServerInvocationHandler&lt;/handler&gt;
            &lt;/handlers&gt;
         &lt;/config&gt;
      &lt;/attribute&gt;
   &lt;/mbean&gt;
   
   &lt;mbean code="org.jboss.jms.server.connectionfactory.ConnectionFactory"
      name="jboss.messaging.destination:service=HttpConnectionFactory"
      xmbean-dd="xmdesc/ConnectionFactory-xmbean.xml"&gt;
      &lt;depends optional-attribute-name="ServerPeer"&gt;jboss.messaging:service=ServerPeer&lt;/depends&gt;
      &lt;depends optional-attribute-name="Connector"&gt;jboss.messaging:service=Connector,transport=http&lt;/depends&gt;
      &lt;attribute name="JNDIBindings"&gt;
         &lt;bindings&gt;
            &lt;binding&gt;/HttpConnectionFactory&lt;/binding&gt;
         &lt;/bindings&gt;
      &lt;/attribute&gt;
   &lt;/mbean&gt;

&lt;/server&gt;</pre>
      </td>
    </tr>
  </tbody>
</table>
<h2>Troubleshooting</h2>
<h3>1. I get <span style="font-family: monospace;">"javax.jms.JMSSecurityException:
User null is NOT authenticated" <br>
</span></h3>
You probably didn't install JBoss Messaging correctly. A fresh JBoss
Messaging installation requires changes in the security configuration
of a <span style="font-family: monospace;">default </span>JBoss
instance, specifically a properly configured "<small><span
 style="font-family: courier new,courier,monospace;">messaging</span></small>"
security domain.&nbsp; Follow the instructions from the "Installation"
paragraph of the release documentation. <br>
<br>
<br>
<br>
<br>
<hr style="width: 100%; height: 2px;"><br>
<br>
<br>
<br>
<br>
<br>
<br>
</body>
</html>
