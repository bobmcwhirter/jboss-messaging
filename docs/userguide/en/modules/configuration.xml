<?xml version="1.0" encoding="UTF-8"?>
<chapter id="configuration">
   <title>Configuration</title>
   <para>The JMS API specifies how a messaging client interacts with a
      messaging server. The exact definition and implementation of messaging
      services, such as message destinations, connection factories and security, are
      specific to JMS providers. JBoss Messaging has its own configuration files
      to configure these.
   </para>
   <para>In this chapter, we discuss how to configure JBoss Messaging, which work together to provide JMS API level
      services to client applications.
   </para>
   <para>JBoss Messaging configuration is spread among several
      configuration files.
      <itemizedlist>
         <listitem>
            <filename>jbm-configuration.xml</filename>
         </listitem>
         <listitem>
            <filename>jbm-security.xml</filename>
         </listitem>
         <listitem>
            <filename>queues.xml</filename>
         </listitem>
         <listitem>
            <filename>jbm-jndi.xml</filename>
         </listitem>
         <listitem>
            <filename>jbm-standalone-beans.xml</filename>
            or
            <filename>jbm-beans.xml</filename>
         </listitem>
      </itemizedlist>
   </para>
   <para>The next sections explain each configuration file in detail</para>

   <section id="configuration.main">
      <title>jbm-configuration.xml</title>
      <para>This configuration file is the core configuration for the JBM server. The following is an example of a
         typical configuration
      </para>
      <programlisting>
         <![CDATA[
   <deployment>
      <configuration>

         <!-- TODO!! Should specify all available properties in here -->

         <strict-tck>true</strict-tck>

         <clustered>false</clustered>

         <scheduled-executor-max-pool-size>30</scheduled-executor-max-pool-size>

         <require-destinations>true</require-destinations>

         <!-- Remoting configuration -->

         <!-- one of: TCP, INVM -->
         <!-- INVM: the server is accessible only by clients in the same VM
         (no sockets are opened) -->
         <remoting-transport>TCP</remoting-transport>

         <remoting-bind-address>5400</remoting-bind-address>

         <remoting-host>localhost</remoting-host>

         <!--  timeout in milliseconds -->
         <remoting-timeout>5000</remoting-timeout>

         <!-- true to disable invm communication when the client and the server are in the
         same JVM.     -->
         <!-- it is not allowed to disable invm communication when the remoting-transport
         is set to INVM -->
         <remoting-disable-invm>false</remoting-disable-invm>

         <!-- Enable/Disable Nagle's Algorithm (resp. true/false) -->
         <!-- This setting is taken into account only when remoting-transport is set to
         TCP -->
         <remoting-tcp-nodelay>false</remoting-tcp-nodelay>

         <!-- Set the TCP Receive Buffer size (SO_RCVBUF). -->
         <!-- Set it to -1 if you want to use the value hinted by the Operating System -->
         <!-- This setting is taken into account only when remoting-transport is set to
         TCP -->
         <remoting-tcp-receive-buffer-size>-1</remoting-tcp-receive-buffer-size>

         <!-- Set the TCP Send Buffer size (SO_SNDBUF).-->
         <!-- Set it to -1 if you want to use the value hinted by the Operating System-->
         <!-- This setting is taken into account only when remoting-transport is set to
         TCP -->
         <remoting-tcp-send-buffer-size>-1</remoting-tcp-send-buffer-size>

         <!--  if ssl is enabled, all remoting-ssl-* properties must be set -->
         <remoting-enable-ssl>false</remoting-enable-ssl>

         <remoting-ssl-keystore-path>messaging.keystore</remoting-ssl-keystore-path>

         <remoting-ssl-keystore-password>secureexample</remoting-ssl-keystore-password>

         <remoting-ssl-truststore-path>messaging.truststore</remoting-ssl-truststore-path>

         <remoting-ssl-truststore-password>secureexample</remoting-ssl-truststore-password>

         <!-- Storage configuration -->

         <bindings-directory>${user.home}/jbm-test/data/bindings</bindings-directory>

         <create-bindings-dir>true</create-bindings-dir>

         <journal-directory>${user.home}/jbm-test/data/journal</journal-directory>

         <create-journal-dir>true</create-journal-dir>

         <journal-type>asyncio</journal-type>

         <journal-sync>true</journal-sync>

         <journal-file-size>10485760</journal-file-size>

         <journal-min-files>10</journal-min-files>

         <journal-task-period>5000</journal-task-period>

         <security-enabled>true</security-enabled>

      </configuration>

   </deployment>
]]>
      </programlisting>
      <para>The available configuration attributes are:</para>
      <itemizedlist>
         <listitem>
            <para>strict-tck</para>
            <para>Whether or not this server should adhere to strick tck</para>
         </listitem>
         <listitem>
            <para>clustered</para>
            <para>Whether or not this server is clustered, currently disabled</para>
         </listitem>
         <listitem>
            <para>scheduled-executor-max-pool-size</para>
            <para>The maximum number of threads available for scheduling delivery of scheduled messages</para>
         </listitem>
         <listitem>
            <para>require-destinations</para>
            <para>Whether or not a destination needs to pre-exist when delivering a message</para>
         </listitem>
         <listitem>
            <para>remoting-transport</para>
            <para>Type of transport to use, currently there is only TCP</para>
         </listitem>
         <listitem>
            <para>remoting-bind-address</para>
            <para>The port that JBM will bind to.</para>
         </listitem>
         <listitem>
            <para>remoting-host</para>
            <para>The name of the host that JBM will bind to</para>
         </listitem>
         <listitem>
            <para>remoting-timeout</para>
            <para>The timeout setting, in milliseconds, for both client and server connections</para>
         </listitem>
         <listitem>
            <para>remoting-disable-invm</para>
            <para>not used at present</para>
         </listitem>
         <listitem>
            <para>remoting-tcp-nodelay</para>
            <para>Sets the TCP nodelay setting when a TCP transport is used</para>
         </listitem>
         <listitem>
            <para>remoting-tcp-receive-buffer-size</para>
            <para>sets the TCP receive buffer size, -1 will set it to the value that the OS hints at to use. This is
               only used when TCP transport is configured</para>
         </listitem>
         <listitem>
            <para>remoting-tcp-send-buffer-size</para>
            <para>sets the TCP send buffer size, -1 will set it to the value that the OS hints at to use. This is
               only used when TCP transport is configured</para>
         </listitem>
         <listitem>
            <para>remoting-enable-ssl</para>
            <para>Whether SSL is enabled for this server. If this is true then next 4 SSL properties need to be set</para>
         </listitem>
         <listitem>
            <para>remoting-ssl-keystore-path>messaging.keystore</para>
            <para>The location of the SSL keystore</para>
         </listitem>
         <listitem>
            <para>remoting-ssl-keystore-password</para>
            <para>The password for the SSL keystore</para>
         </listitem>
         <listitem>
            <para>remoting-ssl-truststore-path</para>
            <para>The location of the SSL truststore</para>
         </listitem>
         <listitem>
            <para>remoting-ssl-truststore-password</para>
            <para>The password for the truststore</para>
         </listitem>
         <listitem>
            <para>bindings-directory</para>
            <para>The directory to create the bindings persistence files in.</para>
         </listitem>
         <listitem>
            <para>create-bindings-dir</para>
            <para>Whether to create the bindings directory if it doesnt exist.</para>
         </listitem>
         <listitem>
            <para>journal-type</para>
            <para>The type of journal to use, valid configurations are 'asyncio','nio' and 'jdbc'. refere to the
            'The journal based persistence approach' chapter for more detailed information</para>
         </listitem>
         <listitem>
            <para>journal-sync</para>
            <para>Whether or not to allow the synch to disk on commit and rollback. false will only write to the OS buffers
            and lets the OS deal with synching</para>
         </listitem>
         <listitem>
            <para>journal-file-size</para>
            <para>The size of the data file to create, these files are pre-allocated and filled as needed.</para>
         </listitem>
         <listitem>
            <para>journal-min-files</para>
            <para>Minimum number of created files to start with</para>
         </listitem>
         <listitem>
            <para>journal-task-period</para>
            <para>How frequently to reclaim unused journal data files, in milliseconds.</para>
         </listitem>
         <listitem>
            <para>security-enabled</para>
            <para>Whether security is enabled, if false no security checks are made.</para>
         </listitem>
      </itemizedlist>
   </section>
   <section id="configuration.security">
      <title>jbm-security.xml</title>
      <para>This configuration file is used to configure users and roles when JBM is running in standalone mode using
         the JBM Security Manager. The Security manager used is a pluggable component whose implementation can be
         changed by
         configuring the appropriate beans configuration file. Refer to the beans configuration section on how to do
         this.
         A typical jbm-security.xml config looks like:
      </para>
      <programlisting>
         <![CDATA[
   <deployment>
      <user name="guest" password="guest">
         <role name="guest"/>
      </user>
   </deployment>
       ]]>
      </programlisting>
      <para>The available configuration attributes are:</para>
      <itemizedlist>
         <listitem>
            <para>user</para>
            <para>The user to add to the security manager. This must have the attribute 'name' and 'password' set.
            </para>
            <itemizedlist>
               <listitem>
                  <para>role</para>
                  <para>A role that the user has, a user may have multiple roles configured.</para>
               </listitem>
            </itemizedlist>
         </listitem>
      </itemizedlist>
   </section>
   <section id="configuration.queues">
      <title>queues.xml</title>
      <para>This configuration file is used to configure the security and settings for destinations. These are matched
         against a destination using an hierarchical style match that supports both wild cards ('*') and word
         replacement ('^')
      </para>
      <para>For instance a destination withname 'queuejms.aqueue.myQueue' would match against 'queuejms.*',
         'queuejms.aqueue.^', 'queuejms.^.myQueue' and obviously 'queuejms.aqueue.myQueue'. If a destination has
         multiple
         matches then the most precise match is used
      </para>
      <programlisting>
         <![CDATA[
   <deployment>

      <security match="topicjms.testTopic">
         <permission type="create" roles="durpublisher"/>
         <permission type="read" roles="guest,publisher,durpublisher"/>
         <permission type="write" roles="guest,publisher,durpublisher"/>
      </security>

      <security match="topicjms.securedTopic">
         <permission type="write" roles="publisher"/>
         <permission type="read" roles="publisher"/>
      </security>

      <security match="topicjms.testDurableTopic">
         <permission type="create" roles="durpublisher"/>
         <permission type="read" roles="guest,publisher,durpublisher"/>
         <permission type="write" roles="guest,publisher,durpublisher"/>
      </security>

      <security match="queuejms.testQueue">
         <permission type="read" roles="guest,publisher"/>
         <permission type="write" roles="guest,publisher"/>
      </security>

      <security match="queuejms.NoSuchQueue">
         <permission type="read" roles="guest,publisher"/>
         <permission type="write" roles="guest,publisher"/>
      </security>

      <security match="topicjms.NoSuchTopic">
         <permission type="read" roles="guest,publisher"/>
         <permission type="write" roles="guest,publisher"/>
      </security>

      <security match="queuetempjms.*">
         <permission type="create" roles="guest,def"/>
         <permission type="read" roles="guest,def"/>
         <permission type="write" roles="guest,def"/>
      </security>

      <security match="topictempjms.*">
         <permission type="create" roles="guest,def"/>
         <permission type="read" roles="guest,def"/>
         <permission type="write" roles="guest,def"/>
      </security>

      <!--this will catch any word i.e. queuejms.anything-->
      <!--<security match="queuejms.^">
         <permission type="read" roles="guest,publisher"/>
         <permission type="write" roles="guest,publisher"/>
      </security>-->

      <!--this will catch any word i.e. queuejms.anything-->
      <!--<security match="topicjms.^">
         <permission type="read" roles="guest,publisher"/>
         <permission type="write" roles="guest,publisher"/>
      </security>-->

      <!--default security to catch all-->
      <security match="*">
         <permission type="create" roles="guest,def"/>
         <permission type="read" roles="guest,def"/>
         <permission type="write" roles="guest,def"/>
      </security>

      <queue-settings match="queuejms.QueueWithOwnDLQAndExpiryQueue">
         <dlq>PrivateDLQ</dlq>
         <expiry-queue>queuejms.PrivateExpiryQueue</expiry-queue>
      </queue-settings>

      <queue-settings match="topicjms.TopicWithOwnDLQAndExpiryQueue">
         <dlq>PrivateDLQ</dlq>
         <expiry-queue>queuejms.PrivateExpiryQueue</expiry-queue>
      </queue-settings>

      <queue-settings match="queuejms.QueueWithOwnRedeliveryDelay">
         <redelivery-delay>5000</redelivery-delay>
      </queue-settings>

      <queue-settings match="topicjms.TopicWithOwnRedeliveryDelay">
         <redelivery-delay>5000</redelivery-delay>
      </queue-settings>

      <queue-settings match="queuejms.testDistributedQueue">
         <clustered>true</clustered>
      </queue-settings>

      <queue-settings match="topicjms.testDistributedTopic">
         <clustered>true</clustered>
      </queue-settings>

      <queue-settings match="queuejms.testPerfQueue">
         <clustered>false</clustered>
      </queue-settings>

      <!--default for catch all-->
      <queue-settings match="*">
         <clustered>false</clustered>
         <dlq>DLQ</dlq>
         <expiry-queue>queuejms.ExpiryQueue</expiry-queue>
         <redelivery-delay>0</redelivery-delay>
         <max-size>-1</max-size>
         <distribution-policy-class>
            org.jboss.messaging.core.server.impl.RoundRobinDistributionPolicy
         </distribution-policy-class>
         <message-counter-history-day-limit>10</message-counter-history-day-limit>
      </queue-settings>

   </deployment>
       ]]>
      </programlisting>
      <para>The available configuration attributes are:</para>
      <itemizedlist>
         <listitem>
            <para>security</para>
            <para>The securitysettings to use when clients access a destination.</para>
            <itemizedlist>
               <listitem>
                  <para>permission</para>
                  <para>This describes the permissions a user must have to perform certain tasks. The permission type
                     can be 'create','write' or 'read' and the roles are a comma seperated list of roles.
                  </para>
               </listitem>
            </itemizedlist>
         </listitem>
         <listitem>
            <para>queue-settings</para>
            <para>These are the settings applied to a queue its creation.</para>
            <itemizedlist>
               <listitem>
                  <para>clustered</para>
                  <para>Whether or not this queue is clustered</para>
               </listitem>
               <listitem>
                  <para>dlq</para>
                  <para>The name of the Dead Letter Queue to use for this queue</para>
               </listitem>
               <listitem>
                  <para>expiry-queue</para>
                  <para>The name of the Expiry Queue to use for this queue</para>
               </listitem>
               <listitem>
                  <para>redelivery-delay</para>
                  <para>How long to wait, in milliseconds, before trying to redeliver a message.</para>
               </listitem>
               <listitem>
                  <para>max-size</para>
                  <para>The maximum number of messages a queue can hold before rejecting. -1 means unlimited which is
                     the default
                  </para>
               </listitem>
               <listitem>
                  <para>distribution-policy-class</para>
                  <para>The distribution policy class to use when multiple consumers are registered with a single queue.
                     A round robin policy is used by default.
                  </para>
               </listitem>
            </itemizedlist>
         </listitem>
      </itemizedlist>
   </section>
   <section id="configuration.jms">
      <title>jbm-jndi.xml</title>
      <para>This configuration file is used to create destinations and Connection Factories and make them available in
         JNDI. Note that this is the only configuration file that exposes JMS functionality.
      </para>
      <para>
         A typical jbm-jndi.xml config looks like:
      </para>
      <programlisting>
         <![CDATA[
   <deployment>

   <connection-factory name="testConnectionFactory">
      <entry name="testConnectionFactory"/>
   </connection-factory>

   <connection-factory name="ConnectionFactory">
      <entry name="/ConnectionFactory"/>
      <entry name="/XAConnectionFactory"/>
      <entry name="java:/ConnectionFactory"/>
      <entry name="java:/XAConnectionFactory"/>
   </connection-factory>

   <connection-factory name="ClusteredConnectionFactory">
      <entry name="/ClusteredConnectionFactory"/>
      <entry name="/ClusteredXAConnectionFactory"/>
      <entry name="java:/ClusteredConnectionFactory"/>
      <entry name="java:/ClusteredXAConnectionFactory"/>
      <supports-failover>true</supports-failover>
      <supports-load-balancing>true</supports-load-balancing>
   </connection-factory>

   <connection-factory name="MyExampleConnectionFactory">
      <entry name="/MyExampleConnectionFactory"/>
      <entry name="/acme/MyExampleConnectionFactoryDupe"/>
      <entry name="java:/xyz/CF1"/>
      <entry name="java:/connectionfactories/acme/connection_factory"/>
      <!-- You can specify the default Client ID to use for connections created
      using this factory -->
      <client-id>MyClientID</client-id>
      <!-- PrefetchSize determines the maximum number of messages the client consumer
      will buffer locally -->
      <prefetch-size>150</prefetch-size>
      <!-- The batch size to use when using the DUPS_OK_ACKNOWLEDGE acknowledgement mode -->
      <dups-ok-batch-size>5000</dups-ok-batch-size>
      <!-- Does this connection factory support automatic failover? -->
      <supports-failover>false</supports-failover>
      <!-- Does this connection factory support automatic client side load balancing? -->
      <supports-load-balancing>false</supports-load-balancing>
      <!-- The class name of the factory used to create the load balancing policy to
      use on the client side -->
      <load-balancing-factory>
         org.jboss.messaging.jms.client.plugin.RoundRobinLoadBalancingFactory
      </load-balancing-factory>
      <!-- Whether we should be strict TCK compliant, i.e. how we deal with foreign messages,
      defaults to false-->
      <strict-tck>true</strict-tck>

      <!-- This is the window size in number of messages to use when using producer
      window based flow control -->
      <producer-window-size>1000</producer-window-size>

      <!-- This is the maximum producer send rate that will be applied when using
      rate based producer flow control -->
      <producer-max-rate>100</producer-max-rate>

   </connection-factory>

   <queue name="DLQ">
      <entry name="/queue/DLQ"/>
   </queue>
   <queue name="ExpiryQueue">
      <entry name="/queue/ExpiryQueue"/>
   </queue>
   <topic name="testTopic">
      <entry name="/topic/testTopic"/>
   </topic>
   <topic name="securedTopic">
      <entry name="/topic/securedTopic"/>
   </topic>
   <topic name="testDurableTopic">
      <entry name="/topic/testDurableTopic"/>
   </topic>
   <queue name="testQueue">
      <entry name="/queue/testQueue"/>
   </queue>
   <queue name="testPerfQueue">
      <entry name="/queue/testPerfQueue"/>
   </queue>
   <queue name="A">
      <entry name="/queue/A"/>
   </queue>
   <queue name="B">
      <entry name="/queue/B"/>
   </queue>
   <queue name="C">
      <entry name="/queue/C"/>
   </queue>
   <queue name="D">
      <entry name="/queue/D"/>
   </queue>
   <queue name="ex">
      <entry name="/queue/ex"/>
   </queue>
   <queue name="PrivateDLQ">
      <entry name="/queue/PrivateDLQ"/>
   </queue>
   <queue name="PrivateExpiryQueue">
      <entry name="/queue/PrivateExpiryQueue"/>
   </queue>
   <queue name="QueueWithOwnDLQAndExpiryQueue">
      <entry name="/queue/QueueWithOwnDLQAndExpiryQueue"/>
   </queue>
   <topic name="TopicWithOwnDLQAndExpiryQueue">
      <entry name="/topic/QueueWithOwnDLQAndExpiryQueue"/>
   </topic>
   <queue name="QueueWithOwnRedeliveryDelay">
      <entry name="/queue/QueueWithOwnRedeliveryDelay"/>
   </queue>
   <topic name="TopicWithOwnRedeliveryDelay">
      <entry name="/queue/TopicWithOwnRedeliveryDelay"/>
   </topic>
   <queue name="testDistributedQueue">
      <entry name="/topic/testDistributedQueue"/>
   </queue>
   <topic name="testDistributedTopic">
      <entry name="/topic/testDistributedTopic"/>
   </topic>

</deployment>
       ]]>
      </programlisting>
      <para>The available configuration attributes are:</para>
      <itemizedlist>
         <listitem>
            <para>connection-factory</para>
            <para>The connection factory to create with a unique name</para>
            <itemizedlist>
               <listitem>
                  <para>entry</para>
                  <para>The name to store the Connection Factory object in JNDI with.
                     Multiple JNDI entries can be added.</para>
               </listitem>
               <listitem>
                  <para>client-id</para>
                  <para>The client id for connections created using this Connection Factory</para>
               </listitem>
               <listitem>
                  <para>prefetch-size</para>
                  <para>The maximum number of messages a consumer can buffer locally</para>
               </listitem>
               <listitem>
                  <para>dups-ok-batch-size</para>
                  <para>The number of acks to batch up when DUPS_OK_ACKNOWLEDGE acknowledgement mode is used</para>
               </listitem>
               <listitem>
                  <para>supports-failover</para>
                  <para>Does the Connection Factory support failover, currently disabled.</para>
               </listitem>
               <listitem>
                  <para>supports-load-balancing</para>
                  <para>Does the Connection Factory support load balancing, currently disabled</para>
               </listitem>
               <listitem>
                  <para>load-balancing-factory</para>
                  <para>The class to use for creating the load balancing class, currently not used.</para>
               </listitem>
               <listitem>
                  <para>strict-tck</para>
                  <para>Whether strict tck shoul dbe adhered to</para>
               </listitem>
               <listitem>
                  <para>producer-window-size</para>
                  <para>The window size when producer window based flow control is enabled.</para>
               </listitem>
               <listitem>
                  <para>producer-max-rate</para>
                  <para>The max rate when producer rate based flow control is enabled.</para>
               </listitem>
            </itemizedlist>
         </listitem>
         <listitem>
            <para>queue</para>
            <para>The queue to create with a unique name.</para>
            <itemizedlist>
               <listitem>
                  <para>entry</para>
                  <para>The name to store the Connection Factory object in JNDI with.
                     Multiple JNDI entries can be added.</para>
               </listitem>
            </itemizedlist>
         </listitem>
         <listitem>
            <para>topic</para>
            <para>The queue to create with a unique name.</para>
            <itemizedlist>
               <listitem>
                  <para>entry</para>
                  <para>The name to store the Connection Factory object in JNDI with.
                     Multiple JNDI entries can be added.</para>
               </listitem>
            </itemizedlist>
         </listitem>
      </itemizedlist>
   </section>
   <section id="configuration.beans">
      <title>The beans deployment file</title>
      <para>This beans deployment file, usually <literal>jbm-beans.xml</literal> or <literal>jbm-standalone-beans.xml</literal>,
         is used by the <ulink url="http://www.jboss.org/jbossmc/">JBoss Microcontainer</ulink> to bootstrap all the components needed to run a JBoss Messaging Server.
         For the purposes of configuring JBM it is sufficient to know that the implementation details of pluggable
         components are configured here.
      </para>
      <para>The following explains each component in more detail</para>
      <itemizedlist>
         <listitem>
            <para>The naming Service</para>
            <para>This is only found in the standalone version of the beans file. When running within the App Server this
               is not needed since it is available as its own service. This also where you can change the ports used.</para>
            <para>It is possible to replace this with any Naming Service however only the JBoss naming provider has been tested.
            If you do provide your own implementation remember to edit the file jndi.properties</para>
            <programlisting>
               <![CDATA[
   <bean name="Naming" class="org.jnp.server.NamingBeanImpl"/>

   <bean name="Main" class="org.jnp.server.Main">
      <property name="namingInfo"><inject bean="Naming"/> </property>
      <property name="port">1099</property>
      <property name="bindAddress"><inject bean="Configuration" property="host"/></property>
      <property name="rmiPort">1098</property>
      <property name="rmiBindAddress"><inject bean="Configuration" property="host"/></property>
   </bean>
               ]]>
            </programlisting>
         </listitem>
         <listitem>
            <para>The Configuration component</para>
            <programlisting>
               <![CDATA[
      <bean name="Configuration"
         class="org.jboss.messaging.core.config.impl.FileConfiguration"/>
               ]]>
            </programlisting>
            <para>The Configuration component is used to configure the JBM Server and transports. The default implementation,
            <literal>FileConfiguration</literal> reads in the configuration from the file <literal>jbm-configuration.xml</literal>.
             To replace this component your class must implement following interface: </para>
            <programlisting>org.jboss.messaging.core.config.Configuration</programlisting>
         </listitem>
         <listitem>
            <para>The Security Manager</para>
            <para>There are 2 Security Manager implementations available to use. In standalone the default is the following</para>
            <programlisting>
               <![CDATA[
   <bean name="JBMSecurityManager"
      class="org.jboss.messaging.core.security.impl.JBMSecurityManagerImpl">
      <constructor>
         <parameter>false</parameter>
      </constructor>
   </bean>
               ]]>
            </programlisting>
            <para>This uses a simple security manager that also needs the following bean deployed which will read the security
            configuration from the file <literal>jbm-security.xml</literal></para>
            <programlisting>
               <![CDATA[
   <bean name="SecurityManagerDeployer"
      class="org.jboss.messaging.core.deployers.impl.SecurityManagerDeployer">
      <property name="jbmSecurityManager">
         <inject bean="JBMSecurityManager"/>
      </property>
      <property name="messagingServer">
         <inject bean="MessagingServer"/>
      </property>
   </bean>
               ]]>
            </programlisting>
            <para>The second is used when deployed in the JBoss App Server and will make use of JAAS:</para>
            <programlisting>
               <![CDATA[
      <bean name="JBMSecurityManager"
      class="org.jboss.messaging.core.security.impl.JAASSecurityManager"/>
               ]]>
            </programlisting>
            <para>To replace the Security Manager implement the following interface:</para>
            <programlisting>org.jboss.messaging.core.security.JBMSecurityManager</programlisting>
         </listitem>
         <listitem>
            <para>Messaging Server Management</para>
            <para>This exposes Server management operations via JMX. This can be removed if this functionality is not needed</para>
            <programlisting>
               <![CDATA[
   <bean name="MessagingServerManagement"
   class="org.jboss.messaging.core.management.impl.MessagingServerManagementImpl">
      <annotation>
         @org.jboss.aop.microcontainer.aspects.jmx.JMX(
         name="jboss.messaging:service=MessagingServerManagement",
         exposedInterface=org.jboss.messaging.core.management.MessagingServerManagement.class
         )</annotation>
      <property name="messagingServer">
         <inject bean="MessagingServer"/>
      </property>
   </bean>
               ]]>
            </programlisting>
         </listitem>
         <listitem>
            <para>The Messaging Server</para>
            <para>This must never be changed as it is the core messaging server</para>
            <programlisting>
               <![CDATA[
   <bean name="MessagingServer"
   class="org.jboss.messaging.core.server.impl.MessagingServerImpl">
      <property name="storageManager">
         <inject bean="StorageManager"/>
      </property>
      <property name="remotingService">
         <inject bean="RemotingService"/>
      </property>
      <property name="configuration">
         <inject bean="Configuration"/>
      </property>
      <property name="securityManager">
         <inject bean="JBMSecurityManager"/>
      </property>
   </bean>
               ]]>
            </programlisting>
         </listitem>
         <listitem>
            <para>The Storage Manager</para>
            <para>The Storage manager deals with the persistence of messages and bindings. For more information on this
            refer to the chapter 'The journal based persistence approach'.</para>
            <programlisting>
               <![CDATA[
   <bean name="StorageManager"
      class="org.jboss.messaging.core.persistence.impl.journal.JournalStorageManager">
      <constructor>
         <parameter>
            <inject bean="Configuration"/>
         </parameter>
      </constructor>
   </bean>
               ]]>
            </programlisting>
            <para>To replace this pluggable component implement the following interface:</para>
            <programlisting>org.jboss.messaging.core.persistence.StorageManager</programlisting>
         </listitem>
         <listitem>
            <para>The Remoting Service</para>
            <para>The Remoting Service is the transport used by the JBM server</para>
            <programlisting>
               <![CDATA[
   <bean name="RemotingService"
      class="org.jboss.messaging.core.remoting.impl.mina.MinaService">
      <constructor>
         <parameter>
            <inject bean="Configuration"/>
         </parameter>
      </constructor>
   </bean>
               ]]>
            </programlisting>
            <para>To replace this pluggable component implement the following interface:</para>
            <programlisting>org.jboss.messaging.core.remoting.RemotingService</programlisting>
         </listitem>
         <listitem>
            <para>The JMS Server Manager</para>
            <para>The JMS Server Manager exposes JMS operations via JMX. This can be removed if not needed.</para>
            <programlisting>
               <![CDATA[
   <bean name="JMSServerManager"
   class="org.jboss.messaging.jms.server.impl.JMSServerManagerImpl">
      <annotation>
         @org.jboss.aop.microcontainer.aspects.jmx.JMX(
            name="jboss.messaging:service=JMSServerManager",
            exposedInterface=org.jboss.messaging.jms.server.JMSServerManager.class)
            </annotation>
      <property name="messagingServerManagement">
         <inject bean="MessagingServerManagement"/>
      </property>
   </bean>
               ]]>
            </programlisting>
         </listitem>
         <listitem>
            <para>The JMS Server Deployer</para>
            <para>The JMS Server Deployer takes care of deploying Destinations and Connection Factories into JNDi via the
               file <literal>jbm-jndi.xml</literal>. This can be removed if no objects are needed in JNDI or if only core
               messaging is being used.</para>
            <programlisting>
               <![CDATA[
   <bean name="JMSServerDeployer"
   class="org.jboss.messaging.jms.server.impl.JMSServerDeployer">
      <property name="jmsServerManager">
         <inject bean="JMSServerManager"/>
      </property>
      <property name="messagingServer">
         <inject bean="MessagingServer"/>
      </property>
   </bean>
               ]]>
            </programlisting>
         </listitem>
      </itemizedlist>
      
   </section>
</chapter>