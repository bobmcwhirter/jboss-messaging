<html>
  <head>
    <title>JBoss Messaging Embedded Example</title>
    <link rel="stylesheet" type="text/css" href="../../common/common.css"/>
  </head>
  <body>
     <h1>Embedded Example Micro Container</h1>
     <br/>
     <p>This examples shows how to setup and run JBoss Messaging embedded through the Micro Container.</p>
     <p>JBoss Messaging was designed to use POJOs (Plain Old Java Objects), what makes embedding JBoss Messaging as simple as instantiating a few objects.</p>
     <p>Refer to the user's manual for the list of required Jars, since JBoss Micro Container requires a few jars.</p>
     
     <p>JBoss Messaging Embedded could be used from very simple use cases with only InVM support to very complex cases with clustering, persistence and fail over.</p>


     <h2>Example step-by-step</h2>     
     <p><i>To run the example, simply type <code>ant</code> from this directory</i></p>
     <p>In this we don't use any configuration files. (Everything is embedded). We simply instantiate ConfigurationImpl, MessagingServer, start it and operate on JMS regularly</p>
     <br/>
     <ol>
     
        <li>Start the server</li>
        <pre>
         jbm = new JBMBootstrapServer("./server0/jbm-jboss-beans.xml");
         jbm.run();
        </pre>
     
        <li>As we are not using a JNDI environment we instantiate the objects directly</li>
        <pre>
           <code>ClientSessionFactory sf = new ClientSessionFactoryImpl (new TransportConfiguration(NettyConnectorFactory.class.getName()));</code>
        </pre>

        <li>Create a Core Queue</li>
        <pre>
           <code>
         ClientSession coreSession = sf.createSession(false, false, false);
         final String queueName = "queue.exampleQueue";
         coreSession.createQueue(queueName, queueName, true);
         coreSession.close();
           </code>
        </pre>

        <li>Create the session and producer</li>
        <pre>
           <code>
            session = sf.createSession();
                                   
            ClientProducer producer = session.createProducer(queueName);
            </code>
        </pre>

        <li>Create and send a Message</li>
        <pre><code>
            ClientMessage message = session.createClientMessage(false);
            message.putStringProperty(propName, "Hello sent at " + new Date());
            System.out.println("Sending the message.");
            producer.send(message);
       </code></pre>

        <li>Create the message consumer and start the connection</li>
        <pre><code>
            ClientConsumer messageConsumer = session.createConsumer(queueName);
            session.start();</code></pre>

        <li>Receive the message</li>
        <pre><code>
                        ClientMessage messageReceived = messageConsumer.receive(1000);
            System.out.println("Received TextMessage:" + messageReceived.getProperty(propName));</code></pre>

        <li>Be sure to close our resources!</li>

        <pre>
           <code>
           finally
           {
              if (connection != null)
              {
                 connection.close();
              }
           }</code>
        </pre>

        <li>Stop the server</li>

        <pre>
           <code>
           jbm.shutdown();
		   </code>
        </pre>
     </ol>
  </body>
</html>