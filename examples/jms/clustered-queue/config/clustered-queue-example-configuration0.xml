<deployment xmlns="urn:jboss:messaging"
            xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
            xsi:schemaLocation="urn:jboss:messaging ../schemas/jbm-configuration.xsd">
   <configuration>

      <clustered>true</clustered>

      <!-- Maximum number of threads to use for scheduled deliveries -->
      <scheduled-max-pool-size>30</scheduled-max-pool-size>

      <security-enabled>true</security-enabled>

      <security-invalidation-interval>10000</security-invalidation-interval>

      <wild-card-routing-enabled>true</wild-card-routing-enabled>

      <management-address>jbm.management</management-address>
      <management-notification-address>jbm.notifications</management-notification-address>

      <!-- true to expose JBoss Messaging resources through JMX -->
      <jmx-management-enabled>true</jmx-management-enabled>

      <!-- by default, message counter is disabled -->
      <message-counter-enabled>false</message-counter-enabled>

      <connection-scan-period>10000</connection-scan-period>

      <!--how long before timing a transaction out-->
      <transaction-timeout>60000</transaction-timeout>
      <!--how often to scan for timedout transactions-->
      <transaction-timeout-scan-period>1000</transaction-timeout-scan-period>

      <!-- how often do we scan the queues for expired messages-->
      <message-expiry-scan-period>30000</message-expiry-scan-period>
      <!-- the priority of the thread that expires th emessages (between 1 - 10 inclusive)-->
      <message-expiry-thread-priority>3</message-expiry-thread-priority>

      <queue-activation-timeout>30000</queue-activation-timeout>

      <backup>false</backup>

      <persist-delivery-count-before-delivery>false</persist-delivery-count-before-delivery>

      <!-- Connectors -->

      <connector name="netty-connector">
         <factory-class>org.jboss.messaging.integration.transports.netty.NettyConnectorFactory</factory-class>
	 <param key="jbm.remoting.netty.port" value="5445" type="Integer"/>
      </connector>

      <!-- Acceptors -->

      <acceptor name="netty-acceptor">
         <factory-class>org.jboss.messaging.integration.transports.netty.NettyAcceptorFactory</factory-class>
	 <param key="jbm.remoting.netty.port" value="5445" type="Integer"/>
      </acceptor>
     
      <!-- Clustering configuration -->

      <broadcast-group name="my-broadcast-group">
         <group-address>231.7.7.7</group-address>
         <group-port>9876</group-port>
         <broadcast-period>100</broadcast-period>
         <connector-ref connector-name="netty-connector"/>
      </broadcast-group>

      <discovery-group name="my-discovery-group">
         <group-address>231.7.7.7</group-address>
         <group-port>9876</group-port>
         <refresh-timeout>10000</refresh-timeout>
      </discovery-group>
      
      <cluster-connection name="my-cluster">
         <address>jms</address>
	 <retry-interval>500</retry-interval>
	 <use-duplicate-detection>true</use-duplicate-detection>
	 <forward-when-no-consumers>true</forward-when-no-consumers>
	 <max-hops>1</max-hops>
	 <discovery-group-ref discovery-group-name="my-discovery-group"/>
      </cluster-connection>

      <!--  Paging configuration -->

      <paging-max-threads>10</paging-max-threads>

      <paging-directory>server0/data/paging</paging-directory>

      <paging-global-watermark-size>10485760</paging-global-watermark-size>

      <paging-max-global-size-bytes>104857600</paging-max-global-size-bytes>

      <!-- Storage configuration -->

      <bindings-directory>server0/data/bindings</bindings-directory>

      <create-bindings-dir>true</create-bindings-dir>

      <journal-directory>server0/data/journal</journal-directory>

      <create-journal-dir>true</create-journal-dir>

      <journal-type>NIO</journal-type>

      <!-- The journal will reuse any buffers where the size < journal-buffer-reuse-size on write operations
           Set this to -1 to disable this feature -->
      <journal-buffer-reuse-size>1536</journal-buffer-reuse-size>

      <!-- Does the journal sync to disk on each transaction commit, prepare or rollback? -->
      <journal-sync-transactional>true</journal-sync-transactional>

      <!-- Does the journal sync to disk for every non transactional persistent operation? -->
      <journal-sync-non-transactional>false</journal-sync-non-transactional>

      <!-- 10 MB journal file size -->
      <journal-file-size>10485760</journal-file-size>

      <journal-min-files>2</journal-min-files>

      <!-- Maximum simultaneous asynchronous writes accepted by the native layer.
      (parameter ignored on NIO)
       You can verify the max AIO on the OS level at /proc/sys/fs/aio_max_nr. (aio-nr will give you the current max-aio being used)
      -->
      <journal-max-aio>10000</journal-max-aio>

      <large-messages-directory>server0/data/largeMessages</large-messages-directory>
      
   </configuration>

</deployment>
