#!/bin/sh
#
# bash script for running a single unit test case
#
#


#
# core utils
#

#TARGET_CLASS=org.jboss.test.messaging.util.MutableStateTest
#TARGET_CLASS=org.jboss.test.messaging.util.StateImplTest

#TARGET_CLASS=org.jboss.test.messaging.util.SingleChannelAcknowledgmentStoreTest
#TARGET_CLASS=org.jboss.test.messaging.util.InMemoryAcknowledgmentStoreTest


# local core
#

#TARGET_CLASS=org.jboss.test.messaging.core.CoreTest
#TARGET_CLASS=org.jboss.test.messaging.core.DistributorTest
#TARGET_CLASS=org.jboss.test.messaging.core.MessageReferenceSupportTest
#TARGET_CLASS=org.jboss.test.messaging.core.MessageSupportTest
#TARGET_CLASS=org.jboss.test.messaging.core.PointToMultipointRouterAsDistributorTest
#TARGET_CLASS=org.jboss.test.messaging.core.PointToPointRouterAsDistributorTest
#TARGET_CLASS=org.jboss.test.messaging.core.RoutableSupportTest
#TARGET_CLASS=org.jboss.test.messaging.core.LocalQueueAsDistributorTest
#TARGET_CLASS=org.jboss.test.messaging.core.LocalTopicAsDistributorTest
#TARGET_CLASS=org.jboss.test.messaging.core.ChannelSupportTest
#TARGET_CLASS=org.jboss.test.messaging.core.TransactionalChannelSupportTest
#TARGET_CLASS=org.jboss.test.messaging.core.LocalQueueAsChannelTest
#TARGET_CLASS=org.jboss.test.messaging.core.LocalTopicAsChannelTest
#TARGET_CLASS=org.jboss.test.messaging.core.AbstractDestinationAsChannelTest
#TARGET_CLASS=org.jboss.test.messaging.core.LocalPipeAsChannelTest

#
# distributed core
#

#TARGET_CLASS=org.jboss.test.messaging.core.distributed.SharedPipeOutputTest
#TARGET_CLASS=org.jboss.test.messaging.core.distributed.ReplicatorTimeoutExceptionTest
#TARGET_CLASS=org.jboss.test.messaging.core.distributed.ReplicatorTest
#TARGET_CLASS=org.jboss.test.messaging.core.distributed.ReplicatorOutputTest
#TARGET_CLASS=org.jboss.test.messaging.core.distributed.InvalidQueueTest
#TARGET_CLASS=org.jboss.test.messaging.core.distributed.QueueTest
#TARGET_CLASS=org.jboss.test.messaging.core.distributed.QueueAsChannelTest
#TARGET_CLASS=org.jboss.test.messaging.core.distributed.PipeAsChannelTest
#TARGET_CLASS=org.jboss.test.messaging.core.distributed.ReplicatorAsChannelTest

#
# JMS Facade
#

TARGET_CLASS=org.jboss.test.messaging.jms.TransactedSessionTest
#TARGET_CLASS=org.jboss.test.messaging.jms.SessionTest
#TARGET_CLASS=org.jboss.test.messaging.jms.MessageProducerTest
#TARGET_CLASS=org.jboss.test.messaging.jms.ConnectionTest
#TARGET_CLASS=org.jboss.test.messaging.jms.ConnectionFactoryTest
#TARGET_CLASS=org.jboss.test.messaging.jms.MessageConsumerTest
#TARGET_CLASS=org.jboss.test.messaging.jms.QueueBrowserTest
#TARGET_CLASS=org.jboss.test.messaging.jms.AcknowledgmentTest

#
# Message tests
#
#TARGET_CLASS=org.jboss.test.messaging.jms.message.JMSExpirationHeaderTest






cygwin=false;
case "`uname`" in
    CYGWIN*)
        cygwin=true
        ;;
esac

if [ $cygwin = true ]; then
    SEP=";"
else
    SEP=":"
fi

#for i in `ls $JBOSS_HOME/client/*.jar`; do
#	JBOSS_CLASSPATH=$i${SEP}$JBOSS_CLASSPATH
#done

while [ "$1" != "" ]; do
    if [ "$1" = "-debug" ]; then
        if [ $cygwin = false ]; then
            JAVA_OPTS="-Xdebug -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=12348"
        else
            JAVA_OPTS="-Xdebug -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=dt_shmem,server=y,suspend=y,address=unittest"
        fi
    fi
    shift
done

#Temporarily use a newer JGroups version, not available in the thirdparty dir
#$reldir/../../../thirdparty/javagroups-javagroups/lib/jgroups.jar${SEP}\

#Temporarily I use the "patched" jboss-remoting.jar from src/resources
#$reldir/../../../remoting/output/lib/jboss-remoting.jar${SEP}\


reldir=`dirname $0` 
java $JAVA_OPTS -cp \
$reldir/../../src/etc${SEP}\
$reldir/../../tests/output/classes${SEP}\
$reldir/../../output/classes${SEP}\
$reldir/../../../j2ee/output/lib/jboss-j2ee.jar${SEP}\
$reldir/../../../j2se/output/lib/jboss-j2se.jar${SEP}\
$reldir/../resources/jboss-remoting.jar${SEP}\
$reldir/../../../aop/output/lib/jboss-aop.jar${SEP}\
$reldir/../../../thirdparty/apache-log4j/lib/log4j.jar${SEP}\
$reldir/../../../thirdparty/apache-commons/lib/commons-logging.jar${SEP}\
$reldir/../../../thirdparty/junit-junit/lib/junit.jar${SEP}\
$reldir/../../../thirdparty/oswego-concurrent/lib/concurrent.jar${SEP}\
$reldir/../../../thirdparty/javassist/lib/javassist.jar${SEP}\
$reldir/../../../thirdparty/trove/lib/trove.jar${SEP}\
$reldir/../../../thirdparty/apache-commons/lib/commons-httpclient.jar${SEP}\
$reldir/../../../common/output/lib/jboss-common.jar${SEP}\
$reldir/../resources/jgroups-core.jar${SEP}\
 junit.textui.TestRunner $TARGET_CLASS

