<?xml version="1.0" encoding="UTF-8"?>

<!--
     Ant build file that applies changes required by a JBoss Messaging CTS run to a
     CTS installation. For more details see
     http://wiki.jboss.org/wiki/Wiki.jsp?page=JBossMessagingTCKInstallation

     $Id$
 -->

<project name="JBoss Messaging CTS run preparation" default="main" >

   <property environment="ENV"/>

   <target name="main">

      <fail unless="ENV.TS_HOME" message="Environment variable TS_HOME must be set!"/>

      <echo message="Copying CTS configuration files to ${ENV.TS_HOME}/bin/xml"/>
      <copy file="bin/xml/j2ee_jboss_messaging.xml" tofile="${ENV.TS_HOME}/bin/xml/j2ee_vi.xml"
         overwrite="true"/>
      <copy file="bin/xml/jboss-cts.xml" todir="${ENV.TS_HOME}/bin/xml" overwrite="true"/>

      <echo message="Updating ${ENV.TS_HOME}/bin/ts.jte"/>

      <replaceregexp file="${ENV.TS_HOME}/bin/ts.jte" match="server/cts[^-]" replace="server/cts-messaging"/>

      <replaceregexp file="${ENV.TS_HOME}/bin/ts.jte" byline="true"
         match="jboss.jms.destination.manager.object.name=jboss.mq:service=DestinationManager"
         replace="jboss.jms.destination.manager.object.name=jboss.messaging:service=ServerPeer"/>

      <!-- ${jboss.client.dir}, ${jboss.server.home}, etc. MUST NOT be set -->
      <!-- the first part of the classpath (up to jboss-messaging.sar) is copied from
           j2eetck-mods/bin/ts-jboss.jte.
      -->
      <replaceregexp file="${ENV.TS_HOME}/bin/ts.jte" byline="true"
	      match="(jboss.client.classpath=.*)"
	      replace="jboss.client.classpath=${jboss.server.home}/lib/jboss-remoting.jar:${jboss.lib.dir}/jboss-serialization.jar:${jboss.client.dir}/jbossall-client.jar:${jboss.client.dir}/jboss-deployment.jar:${jboss.client.dir}/log4j.jar:${jbossws.classpath}:${jboss.home}/lib/commons-logging.jar:${jboss.home}/lib/gnu-regexp.jar:${jboss.home}/lib/dom4j.jar:${jboss.home}/lib/jboss-common.jar:${jboss.home}/lib/jboss-jmx.jar:${jboss.home}/lib/jboss-system.jar:${jboss.lib.dir}/activation.jar:${jboss.lib.dir}/mail.jar:${jboss.lib.dir}/javax.servlet.jar:${jboss.lib.dir}/jacorb.jar:${jboss.lib.dir}/avalon-framework.jar:${jboss.lib.dir}/jboss-iiop.jar:${jboss.jaxr.classpath}:${jboss.server.home}/deploy/jboss-messaging.sar:${jboss.server.home}/deploy/jboss-aop-jdk50.deployer/jboss-aop-jdk50.jar:${jboss.server.home}/deploy/jboss-aop-jdk50.deployer/javassist.jar:${jboss.server.home}/deploy/jboss-aop-jdk50.deployer/trove.jar:${jboss.server.home}/lib/commons-httpclient.jar"/>

   </target>
   
</project>


