<?xml version="1.0" encoding="UTF-8"?>

<!--
     Hypersonic persistence deployment descriptor.

     $Id$
 -->

<server>

   <mbean code="org.jboss.messaging.core.plugin.JDBCPersistenceManagerService"
      name="jboss.messaging:service=PersistenceManager"
      xmbean-dd="xmdesc/JDBCPersistenceManager-xmbean.xml">
      <!-- TODO this insures the fact that dependency exists. However I need to redundantly specifiy
           the DataSource JNDI name in order to actually get a reference to it. Fix this.
      -->
      <depends>jboss.jca:service=DataSourceBinding,name=DefaultDS</depends>
      <depends optional-attribute-name="TransactionManager">jboss:service=TransactionManager</depends>
      <attribute name="DataSource">java:/DefaultDS</attribute>
      <attribute name="CreateTablesOnStartup">true</attribute>
      <attribute name="UsingBatchUpdates">true</attribute>
   </mbean>

   <mbean code="org.jboss.messaging.core.plugin.DefaultPostOfficeService"
      name="jboss.messaging:service=QueuePostOffice"
      xmbean-dd="xmdesc/SimplePostOffice-xmbean.xml"> 
      <depends optional-attribute-name="ServerPeer">jboss.messaging:service=ServerPeer</depends> 
      <depends>jboss.jca:service=DataSourceBinding,name=DefaultDS</depends>
      <depends optional-attribute-name="TransactionManager">jboss:service=TransactionManager</depends>
      <attribute name="PostOfficeName">Queue</attribute>
      <attribute name="DataSource">java:/DefaultDS</attribute>
      <attribute name="CreateTablesOnStartup">true</attribute>
   </mbean>
   
   <mbean code="org.jboss.messaging.core.plugin.DefaultPostOfficeService"
      name="jboss.messaging:service=TopicPostOffice"
      xmbean-dd="xmdesc/SimplePostOffice-xmbean.xml"> 
      <depends optional-attribute-name="ServerPeer">jboss.messaging:service=ServerPeer</depends>
      <depends>jboss.jca:service=DataSourceBinding,name=DefaultDS</depends>
      <depends optional-attribute-name="TransactionManager">jboss:service=TransactionManager</depends>
      <attribute name="PostOfficeName">Topic</attribute>
      <attribute name="DataSource">java:/DefaultDS</attribute>
      <attribute name="CreateTablesOnStartup">true</attribute>
   </mbean> 
   
   <!--
   
   Uncomment this to enable clustered destinations
   
   <mbean code="org.jboss.messaging.core.plugin.ClusteredTopicPostOfficeService"
      name="jboss.messaging:service=TopicPostOffice"
      xmbean-dd="xmdesc/ClusteredTopicPostOffice-xmbean.xml"> 
      <depends optional-attribute-name="ServerPeer">jboss.messaging:service=ServerPeer</depends>
      <depends>jboss.jca:service=DataSourceBinding,name=DefaultDS</depends>
      <depends optional-attribute-name="TransactionManager">jboss:service=TransactionManager</depends>
      <attribute name="PostOfficeName">Clustered Topic</attribute>
      <attribute name="DataSource">java:/DefaultDS</attribute>
      <attribute name="CreateTablesOnStartup">true</attribute>            
      <attribute name="SqlProperties"><![CDATA[
      <attribute name="GroupName">cluster1</attribute>
      <attribute name="StateTimeout">5000</attribute>
      <attribute name="CastTimeout">5000</attribute>
      <attribute name="PullSize">1</attribute>
      <attribute name="StatsSendPeriod">1000</attribute>
      <attribute name="SyncChannelConfig">
         <UDP mcast_recv_buf_size="500000" down_thread="false" ip_mcast="true" mcast_send_buf_size="32000"
        mcast_port="45566" ucast_recv_buf_size="500000" use_incoming_packet_handler="false"
        mcast_addr="228.8.8.8" use_outgoing_packet_handler="true" loopback="false" ucast_send_buf_size="32000" ip_ttl="32"/>
         <AUTOCONF down_thread="false" up_thread="false"/>
	      <PING timeout="2000" down_thread="false" num_initial_members="3" up_thread="false"/>
	      <MERGE2 max_interval="10000" down_thread="false" min_interval="5000" up_thread="false"/>
	      <FD timeout="2000" max_tries="3" down_thread="false" up_thread="false" shun="true"/>
	      <VERIFY_SUSPECT timeout="1500" down_thread="false" up_thread="false"/>
	      <pbcast.NAKACK max_xmit_size="8192" down_thread="false" use_mcast_xmit="true" gc_lag="50" up_thread="false"
	                   retransmit_timeout="100,200,600,1200,2400,4800"/>
	      <UNICAST timeout="1200,2400,3600" down_thread="false" up_thread="false"/>
	      <pbcast.STABLE stability_delay="1000" desired_avg_gossip="20000" down_thread="false" max_bytes="0" up_thread="false"/>
	      <FRAG frag_size="8192" down_thread="false" up_thread="false"/>
	      <VIEW_SYNC avg_send_interval="60000" down_thread="false" up_thread="false" />
	      <pbcast.GMS print_local_addr="true" join_timeout="3000" down_thread="false" join_retry_timeout="2000" up_thread="false" shun="true"/>
      </attribute>      
      
      <attribute name="AsyncChannelConfig">
         <UDP mcast_recv_buf_size="500000" down_thread="false" ip_mcast="true" mcast_send_buf_size="32000"
        mcast_port="45568" ucast_recv_buf_size="500000" use_incoming_packet_handler="false"
        mcast_addr="228.8.8.8" use_outgoing_packet_handler="true" loopback="false" ucast_send_buf_size="32000" ip_ttl="32"/>
	      <AUTOCONF down_thread="false" up_thread="false"/>
	      <PING timeout="2000" down_thread="false" num_initial_members="3" up_thread="false"/>
	      <MERGE2 max_interval="10000" down_thread="false" min_interval="5000" up_thread="false"/>
	      <FD timeout="2000" max_tries="3" down_thread="false" up_thread="false" shun="true"/>
	      <VERIFY_SUSPECT timeout="1500" down_thread="false" up_thread="false"/>
	      <pbcast.NAKACK max_xmit_size="8192" down_thread="false" use_mcast_xmit="true" gc_lag="50" up_thread="false"
	                   retransmit_timeout="100,200,600,1200,2400,4800"/>
	      <UNICAST timeout="1200,2400,3600" down_thread="false" up_thread="false"/>
	      <pbcast.STABLE stability_delay="1000" desired_avg_gossip="20000" down_thread="false" max_bytes="0" up_thread="false"/>
	      <FRAG frag_size="8192" down_thread="false" up_thread="false"/>
	      <VIEW_SYNC avg_send_interval="60000" down_thread="false" up_thread="false" />
	      <pbcast.GMS print_local_addr="true" join_timeout="3000" down_thread="false" join_retry_timeout="2000" up_thread="false" shun="true"/>
	      <pbcast.STATE_TRANSFER down_thread="false" up_thread="false"/>
      </attribute>      
   </mbean>
   
   -->
   
   <mbean code="org.jboss.jms.server.plugin.JDBCJMSUserManagerService"
      name="jboss.messaging:service=JMSUserManager"
      xmbean-dd="xmdesc/JMSUserManager-xmbean.xml">
      <depends>jboss.jca:service=DataSourceBinding,name=DefaultDS</depends>
      <depends optional-attribute-name="TransactionManager">jboss:service=TransactionManager</depends>
      <attribute name="DataSource">java:/DefaultDS</attribute>
      <attribute name="CreateTablesOnStartup">true</attribute>
   </mbean>    
   
	<mbean code="org.jboss.messaging.core.plugin.JDBCShutdownLoggerService"
      name="jboss.messaging:service=ShutdownLogger"
      xmbean-dd="xmdesc/JDBCShutdownLogger-xmbean.xml">
      <depends>jboss.jca:service=DataSourceBinding,name=DefaultDS</depends>
      <depends optional-attribute-name="TransactionManager">jboss:service=TransactionManager</depends>
      <attribute name="DataSource">java:/DefaultDS</attribute>
      <attribute name="CreateTablesOnStartup">true</attribute>
   </mbean>              
   
</server>