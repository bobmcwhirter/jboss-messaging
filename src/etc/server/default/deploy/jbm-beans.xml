<?xml version="1.0" encoding="UTF-8"?>

<deployment xmlns="urn:jboss:bean-deployer:2.0">

   <bean name="Configuration" class="org.jboss.messaging.core.FileConfiguration"/>

   <bean name="ServiceLocator" class="org.jboss.messaging.microcontainer.ServiceLocator">
      <demand>jboss.jca:name=DefaultDS,service=DataSourceBinding</demand>
      <!--<depends>jboss:service=TransactionManager</depends>-->
      <!-- <depends>jboss.jca:service=DataSourceBinding,name=DefaultDS</depends>-->
   </bean>

   <bean name="MessagingServerManagement" class="org.jboss.messaging.core.impl.server.MessagingServerManagementImpl">
      <annotation>@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="jboss.messaging:service=MessagingServerManagement", exposedInterface=org.jboss.messaging.core.MessagingServerManagement.class)</annotation>
      <property name="messagingServer">
         <inject bean="MessagingServer"/>
      </property>
   </bean>

   <bean name="MessagingServer" class="org.jboss.messaging.core.impl.server.MessagingServerImpl">
      <property name="persistenceManager">
         <inject bean="PersistenceManager"/>
      </property>
      <property name="remotingService">
         <inject bean="RemotingService"/>
      </property> 
      <property name="configuration">
         <inject bean="Configuration"/>
      </property>
      <property name="authenticationManager">
         <inject bean="ServiceLocator" property="authenticationManager"/>
      </property>
   </bean>

   <bean name="PersistenceManager" class="org.jboss.messaging.core.impl.bdbje.BDBJEPersistenceManager">
   
      <property name="largeMessageRepository">${user.home}/bdbje/large</property>
      
      <property name="minLargeMessageSize">1000000</property>
      
      <property name="environment">
         <inject bean="BDBJEEnvironment"/>
      </property>
            
   </bean>
   
   
   
   <bean name="BDBJEEnvironment" class="org.jboss.messaging.core.impl.bdbje.integration.RealBDBJEEnvironment">
   
      <property name="environmentPath">${user.home}/bdbje/env</property>
      
      <property name="createEnvironment">true</property>
      
      <property name="syncVM">true</property>
      
      <property name="syncOS">false</property>
   
      <property name="memoryCacheSize">-1</property>
            
   </bean>

   <bean name="RemotingService" class="org.jboss.messaging.core.remoting.impl.mina.MinaService">
      <constructor>
         <parameter>
            <inject bean="Configuration" property="remotingConfiguration"/>
         </parameter>
      </constructor>
   </bean> 
   
   <bean name="JMSServerManager" class="org.jboss.jms.server.JMSServerManagerImpl">
      <annotation>@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="jboss.messaging:service=JMSServerManager", exposedInterface=org.jboss.jms.server.JMSServerManager.class)</annotation>
      <property name="messagingServerManagement">
         <inject bean="MessagingServerManagement"/>
      </property>
   </bean>

   <bean name="JMSServerDeployer" class="org.jboss.jms.server.JMSServerDeployer">
      <property name="jmsServerManager">
         <inject bean="JMSServerManager"/>
      </property>
   </bean>
 
</deployment>