<?xml version="1.0" encoding="UTF-8"?>

<!--
     The JBoss Messaging service deployment descriptor.

     $Id$
 -->

<server>

   <!--
   <loader-repository>jboss.messaging:loader=ScopedLoaderRepository
       <loader-repository-config>java2ParentDelegation=false</loader-repository-config>
   </loader-repository>
   -->

   <!-- JBoss 5 has a remoting connector already deployed. For JBoss 4, I need to deploy it. -->
   <!--
   <mbean code="org.jboss.remoting.transport.Connector"
          xmbean-dd="org/jboss/remoting/transport/Connector.xml"
          name="jboss.messaging:service=Connector,transport=socket"
          display-name="Socket transport Connector">
      <attribute name="Configuration">
         <config>
            <invoker transport="socket">
               <attribute name="dataType" isParam="true">invocation</attribute>
               <attribute name="marshaller" isParam="true">org.jboss.invocation.unified.marshall.InvocationMarshaller</attribute>
               <attribute name="unmarshaller" isParam="true">org.jboss.invocation.unified.marshall.InvocationUnMarshaller</attribute>
               <attribute name="serverBindAddress">${jboss.bind.address}</attribute>
               <attribute name="serverBindPort">4457</attribute>
            </invoker>
            <handlers>
               <handler subsystem="why_do_I_need_this">org.jboss.jms.server.remoting.JMSServerInvocationHandler</handler>
            </handlers>
         </config>
      </attribute>
      <depends>jboss.messaging:service=NetworkRegistry</depends>
   </mbean>

   <mbean code="org.jboss.remoting.network.NetworkRegistry"
          name="jboss.messaging:service=NetworkRegistry"/>
   -->

   <!-- The Server Peer -->
   <mbean code="org.jboss.jms.server.ServerPeer"
      name="jboss.messaging:service=ServerPeer"
      xmbean-dd="xmdesc/ServerPeer-xmbean.xml">

      <constructor>
         <!-- ServerPeerID -->
         <arg type="java.lang.String" value="server.0" />
         <!-- DefaultQueueJNDIContext -->
         <arg type="java.lang.String" value="/queue" />
         <!-- DefaultTopicJNDIContext -->
         <arg type="java.lang.String" value="/topic" />
      </constructor>

      <depends optional-attribute-name="Connector">jboss.remoting:service=Connector,transport=socket</depends>
      <depends optional-attribute-name="ThreadPool">jboss.messaging:service=ThreadPool</depends>
      <depends optional-attribute-name="TransactionLog">jboss.messaging:service=TransactionLog</depends>
      <depends optional-attribute-name="MessageStore">jboss.messaging:service=MessageStore</depends>
      <depends optional-attribute-name="DurableSubscriptionStore">jboss.messaging:service=DurableSubscriptionStore</depends>

      <attribute name="SecurityDomain">java:/jaas/messaging</attribute>
      <attribute name="DefaultSecurityConfig">
        <security>
            <role name="guest" read="true" write="true" create="true"/>
        </security>
      </attribute>
   </mbean>

   <!-- Plug-ins -->

   <mbean code="org.jboss.jms.server.plugin.DefaultThreadPool"
      name="jboss.messaging:service=ThreadPool"
      xmbean-dd="xmdesc/DefaultThreadPool-xmbean.xml">
      <constructor>
         <!-- the default pool size -->
         <arg type="int" value="40" />
      </constructor>
   </mbean>

   <mbean code="org.jboss.messaging.core.plugin.JDBCTransactionLog"
      name="jboss.messaging:service=TransactionLog"
      xmbean-dd="xmdesc/JDBCTransactionLog-xmbean.xml">

      <!-- TODO this insures the fact that dependency exists. However I need to redundantly specifiy
           the DataSource JNDI name in order to actually get a reference to it. Fix this.
      -->
      <depends>jboss.jca:service=DataSourceBinding,name=DefaultDS</depends>
      <depends optional-attribute-name="TransactionManager">jboss:service=TransactionManager</depends>
      <attribute name="DataSource">java:/DefaultDS</attribute>
   </mbean>

   <mbean code="org.jboss.jms.server.plugin.JDBCMessageStore"
      name="jboss.messaging:service=MessageStore"
      xmbean-dd="xmdesc/JDBCMessageStore-xmbean.xml">
      <constructor>
         <!-- StoreID -->
         <arg type="java.lang.String" value="store.0" />
      </constructor>
      <!-- TODO this insures the fact that dependency exists. However I need to redundantly specifiy
           the DataSource JNDI name in order to actually get a reference to it. Fix this.
      -->
      <depends>jboss.jca:service=DataSourceBinding,name=DefaultDS</depends>
      <depends optional-attribute-name="TransactionManager">jboss:service=TransactionManager</depends>
      <attribute name="DataSource">java:/DefaultDS</attribute>
   </mbean>

   <mbean code="org.jboss.jms.server.plugin.JDBCDurableSubscriptionStore"
      name="jboss.messaging:service=DurableSubscriptionStore"
      xmbean-dd="xmdesc/JDBCDurableSubscriptionStore-xmbean.xml">

      <!-- TODO this insures the fact that dependency exists. However I need to redundantly specifiy
           the DataSource JNDI name in order to actually get a reference to it. Fix this.
      -->
      <depends>jboss.jca:service=DataSourceBinding,name=DefaultDS</depends>
      <depends optional-attribute-name="TransactionManager">jboss:service=TransactionManager</depends>
      <attribute name="DataSource">java:/DefaultDS</attribute>
   </mbean>

   <!-- ConnectionFactories -->

   <mbean code="org.jboss.jms.server.connectionfactory.ConnectionFactory"
      name="jboss.messaging.destination:service=ConnectionFactory"
      xmbean-dd="xmdesc/ConnectionFactory-xmbean.xml">
      <depends optional-attribute-name="ServerPeer">jboss.messaging:service=ServerPeer</depends>
      <attribute name="JNDIBindings">
         <bindings>
            <binding>/ConnectionFactory</binding>
            <binding>/XAConnectionFactory</binding>
            <binding>java:/ConnectionFactory</binding>
            <binding>java:/XAConnectionFactory</binding>
         </bindings>
      </attribute>
   </mbean>

   <!-- Test destinations -->

   <mbean code="org.jboss.jms.server.destination.Topic"
      name="jboss.messaging.destination:service=Topic,name=testTopic"
      xmbean-dd="xmdesc/Topic-xmbean.xml">
      <depends optional-attribute-name="ServerPeer">jboss.messaging:service=ServerPeer</depends>
      <attribute name="SecurityConfig">
         <security>
            <role name="guest" read="true" write="true"/>
            <role name="publisher" read="true" write="true" create="false"/>
            <role name="durpublisher" read="true" write="true" create="true"/>
         </security>
      </attribute>
   </mbean>

   <mbean code="org.jboss.jms.server.destination.Topic"
      name="jboss.messaging.destination:service=Topic,name=securedTopic"
      xmbean-dd="xmdesc/Topic-xmbean.xml">
      <depends optional-attribute-name="ServerPeer">jboss.messaging:service=ServerPeer</depends>
      <attribute name="SecurityConfig">
         <security>
            <role name="publisher" read="true" write="true" create="false"/>
         </security>
      </attribute>
   </mbean>

   <mbean code="org.jboss.jms.server.destination.Topic"
      name="jboss.messaging.destination:service=Topic,name=testDurableTopic"
      xmbean-dd="xmdesc/Topic-xmbean.xml">
      <depends optional-attribute-name="ServerPeer">jboss.messaging:service=ServerPeer</depends>
      <attribute name="SecurityConfig">
         <security>
            <role name="guest" read="true" write="true"/>
            <role name="publisher" read="true" write="true" create="false"/>
            <role name="durpublisher" read="true" write="true" create="true"/>
         </security>
      </attribute>
   </mbean>

   <mbean code="org.jboss.jms.server.destination.Queue"
      name="jboss.messaging.destination:service=Queue,name=testQueue"
      xmbean-dd="xmdesc/Queue-xmbean.xml">
      <depends optional-attribute-name="ServerPeer">jboss.messaging:service=ServerPeer</depends>
      <attribute name="SecurityConfig">
         <security>
            <role name="guest" read="true" write="true"/>
            <role name="publisher" read="true" write="true" create="false"/>
            <role name="noacc" read="false" write="false" create="false"/>
         </security>
      </attribute>
   </mbean>

   <!-- We need this to deploy MDBs -->

   <mbean code="org.jboss.jms.server.destination.Queue"
      name="jboss.messaging.destination:service=Queue,name=DLQ"
      xmbean-dd="xmdesc/Queue-xmbean.xml">
      <depends optional-attribute-name="ServerPeer">jboss.messaging:service=ServerPeer</depends>
   </mbean>

   <!-- Example queues -->

   <mbean code="org.jboss.jms.server.destination.Queue"
      name="jboss.messaging.destination:service=Queue,name=A"
      xmbean-dd="xmdesc/Queue-xmbean.xml">
      <depends optional-attribute-name="ServerPeer">jboss.messaging:service=ServerPeer</depends>
   </mbean>

   <mbean code="org.jboss.jms.server.destination.Queue"
      name="jboss.messaging.destination:service=Queue,name=B"
      xmbean-dd="xmdesc/Queue-xmbean.xml">
      <depends optional-attribute-name="ServerPeer">jboss.messaging:service=ServerPeer</depends>
   </mbean>

   <mbean code="org.jboss.jms.server.destination.Queue"
      name="jboss.messaging.destination:service=Queue,name=C"
      xmbean-dd="xmdesc/Queue-xmbean.xml">
      <depends optional-attribute-name="ServerPeer">jboss.messaging:service=ServerPeer</depends>
   </mbean>

   <mbean code="org.jboss.jms.server.destination.Queue"
      name="jboss.messaging.destination:service=Queue,name=D"
      xmbean-dd="xmdesc/Queue-xmbean.xml">
      <depends optional-attribute-name="ServerPeer">jboss.messaging:service=ServerPeer</depends>
   </mbean>

   <mbean code="org.jboss.jms.server.destination.Queue"
      name="jboss.messaging.destination:service=Queue,name=ex"
      xmbean-dd="xmdesc/Queue-xmbean.xml">
      <depends optional-attribute-name="ServerPeer">jboss.messaging:service=ServerPeer</depends>
   </mbean>

</server>