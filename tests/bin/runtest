#!/bin/sh
#
# bash script for running a single unit test case
#
#

#
# util
#
#TARGET_CLASS=org.jboss.test.messaging.util.SelectiveIteratorTest
#TARGET_CLASS=org.jboss.test.messaging.util.UtilTest


#
# core
#

#TARGET_CLASS=org.jboss.test.messaging.core.SimpleDeliveryTest
#TARGET_CLASS=org.jboss.test.messaging.core.ReplicatorOutputDeliveryTest



#
# core utils
#

# local core
#

#TARGET_CLASS=org.jboss.test.messaging.core.CoreTest
#TARGET_CLASS=org.jboss.test.messaging.core.NonRecoverableState1Test
#TARGET_TEST=testNonRecoverableState_remove_2
#TARGET_CLASS=org.jboss.test.messaging.core.NonRecoverableState2Test
#TARGET_TEST=testNonRecoverableState_17
#TARGET_CLASS=org.jboss.test.messaging.core.RecoverableStateTest
#TARGET_TEST=testRecoverableState_57

#TARGET_CLASS=org.jboss.test.messaging.core.local.NonRecoverableQueueTest
#TARGET_TEST=testNonRecoverableChannel_25_race
#TARGET_CLASS=org.jboss.test.messaging.core.local.RecoverableQueueTest
#TARGET_TEST=testAddReceiver_6
#TARGET_CLASS=org.jboss.test.messaging.core.local.SubscriptionTest
#TARGET_CLASS=org.jboss.test.messaging.core.local.DurableSubscriptionTest
TARGET_CLASS=org.jboss.test.messaging.core.local.TopicTest
#TARGET_TEST=testNACKINGReceiver


#TARGET_CLASS=org.jboss.test.messaging.core.DistributorTest
#TARGET_CLASS=org.jboss.test.messaging.core.MessageReferenceSupportTest
#TARGET_CLASS=org.jboss.test.messaging.core.MessageSupportTest
#TARGET_CLASS=org.jboss.test.messaging.core.PointToMultipointRouterAsDistributorTest
#TARGET_CLASS=org.jboss.test.messaging.core.PointToPointRouterAsDistributorTest
#TARGET_CLASS=org.jboss.test.messaging.core.RoutableSupportTest
#TARGET_CLASS=org.jboss.test.messaging.core.LocalQueueAsDistributorTest
#TARGET_CLASS=org.jboss.test.messaging.core.LocalTopicAsDistributorTest
#TARGET_CLASS=org.jboss.test.messaging.core.ChannelSupportTest
#TARGET_CLASS=org.jboss.test.messaging.core.TransactionalChannelSupportTest
#TARGET_CLASS=org.jboss.test.messaging.core.LocalQueueAsChannelTest
#TARGET_CLASS=org.jboss.test.messaging.core.LocalTopicAsChannelTest
#TARGET_CLASS=org.jboss.test.messaging.core.AbstractDestinationAsChannelTest
#TARGET_CLASS=org.jboss.test.messaging.core.LocalPipeAsChannelTest

#TARGET_CLASS=org.jboss.test.messaging.core.persistence.JDBCUtilTest

#
# core - message
#
#TARGET_CLASS=org.jboss.test.messaging.core.message.InMemoryMessageStoreTest
#TARGET_CLASS=org.jboss.test.messaging.core.message.PersistentMessageStoreTest
#TARGET_TEST=testRecoverableMessageStore_1

#
# core - persistence
#

#TARGET_CLASS=org.jboss.test.messaging.core.persistence.CoreMessageJDBCPersistenceManagerTest
#TARGET_TEST=testAddRetrieveRemoveMessage

#
# distributed core
#

#TARGET_CLASS=org.jboss.test.messaging.core.distributed.pipe.SharedPipeOutputTest
#TARGET_CLASS=org.jboss.test.messaging.core.distributed.replicator.ReplicatorTimeoutExceptionTest
#TARGET_CLASS=org.jboss.test.messaging.core.distributed.replicator.ToEraseReplicatorOutputTest
#TARGET_CLASS=org.jboss.test.messaging.core.distributed.queue.InvalidQueueTest
#TARGET_CLASS=org.jboss.test.messaging.core.distributed.queue.QueueTest
#TARGET_CLASS=org.jboss.test.messaging.core.distributed.queue.QueueAsChannelTest
#TARGET_CLASS=org.jboss.test.messaging.core.distributed.pipe.PipeAsChannelTest
#TARGET_CLASS=org.jboss.test.messaging.core.distributed.PeerIdentityTest

#
# core.distributed.queue
#
#TARGET_CLASS=org.jboss.test.messaging.core.distributed.queue.QueuePeerTest
#TARGET_CLASS=org.jboss.test.messaging.core.distributed.queue.NonRecoverableDistributedQueueTest
#TARGET_CLASS=org.jboss.test.messaging.core.distributed.queue.RecoverableDistributedQueueTest
#TARGET_TEST=testRecoverableDistributedChannel_3
#TARGET_TEST=testSimpleSend

#
# core.distributed.topic
#
#TARGET_CLASS=org.jboss.test.messaging.core.distributed.topic.TopicPeerTest
#TARGET_TEST=testTwoPeers_1
TARGET_CLASS=org.jboss.test.messaging.core.distributed.topic.DistributedTopicTest
TARGET_TEST=testDistributeTopic_1

#
# core.distributed.replicator
#
#TARGET_CLASS=org.jboss.test.messaging.core.distributed.replicator.CompositeDeliveryTest
#TARGET_TEST=testDelivery_5
#TARGET_CLASS=org.jboss.test.messaging.core.distributed.replicator.CompositeDelivery2Test
#TARGET_CLASS=org.jboss.test.messaging.core.distributed.replicator.ReplicatorOutputTest
#TARGET_CLASS=org.jboss.test.messaging.core.distributed.replicator.ReplicatorTest
#TARGET_TEST=testReplicator_47
#TARGET_CLASS=org.jboss.test.messaging.core.distributed.replicator.ReplicatorAsChannelTest

#
# distributed utils
#
#TARGET_CLASS=org.jboss.test.messaging.core.distributed.util.RpcServerTest
#TARGET_TEST=testNoSuchMethodName_Local


#
# JMS Facade
#

#TARGET_CLASS=org.jboss.test.messaging.jms.TransactedSessionTest
#TARGET_TEST=testRedeliveredFlagLocalTopic
#TARGET_CLASS=org.jboss.test.messaging.jms.SessionTest
#TARGET_TEST=testCreateTwoSessions
#TARGET_CLASS=org.jboss.test.messaging.jms.MessageProducerTest
#TARGET_TEST=testCreateProducerOnInexistentDestination
#TARGET_CLASS=org.jboss.test.messaging.jms.ConnectionTest
#TARGET_TEST=testClose1
#TARGET_CLASS=org.jboss.test.messaging.jms.ConnectionClosedTest
#TARGET_TEST=testCannotReceiveMessageOnStoppedConnection
#TARGET_CLASS=org.jboss.test.messaging.jms.ConnectionConsumerTest
#TARGET_TEST=testSimple
#TARGET_CLASS=org.jboss.test.messaging.jms.ConnectionFactoryTest
#TARGET_CLASS=org.jboss.test.messaging.jms.MessageConsumerTest
#TARGET_TEST=testCreateConsumerOnInexistentDestination
#TARGET_CLASS=org.jboss.test.messaging.jms.BrowserTest
#TARGET_TEST=testBrowseWithSelector
#TARGET_CLASS=org.jboss.test.messaging.jms.AcknowledgmentTest
#TARGET_TEST=testClientAcknowledgeNoAcknowlegment
#TARGET_CLASS=org.jboss.test.messaging.jms.TemporaryDestinationTest
#TARGET_CLASS=org.jboss.test.messaging.jms.selector.SelectorTest
#TARGET_CLASS=org.jboss.test.messaging.jms.QueueTest
#TARGET_TEST=testQueue
#TARGET_CLASS=org.jboss.test.messaging.jms.TopicTest
#TARGET_TEST=testQueue

#
# JMS Facade server
#
#TARGET_CLASS=org.jboss.test.messaging.jms.server.DestinationManagerTest



#
# Message tests
#
#TARGET_CLASS=org.jboss.test.messaging.jms.message.JMSExpirationHeaderTest
#TARGET_CLASS=org.jboss.test.messaging.jms.message.JMSReplyToHeaderTest
#TARGET_CLASS=org.jboss.test.messaging.jms.message.JMSCorrelationIDHeaderTest
#TARGET_TEST=testJMSDestination
#TARGET_CLASS=org.jboss.test.messaging.jms.message.MessageTest
#TARGET_CLASS=org.jboss.test.messaging.jms.message.MessageBodyTest
#TARGET_TEST=testStreamMessage

#TARGET_CLASS=org.jboss.test.messaging.jms.message.TextMessageTest
#TARGET_TEST=testPersistentSend
#TARGET_CLASS=org.jboss.test.messaging.jms.message.MapMessageTest
#TARGET_CLASS=org.jboss.test.messaging.jms.message.BytesMessageTest
#TARGET_TEST=testPersistentSend
#TARGET_CLASS=org.jboss.test.messaging.jms.message.StreamMessageTest
#TARGET_TEST=testNonPersistentSend
#TARGET_CLASS=org.jboss.test.messaging.jms.message.ObjectMessageTest



reldir=`dirname $0`

cygwin=false;
case "`uname`" in
    CYGWIN*)
        cygwin=true
        ;;
esac

if [ $cygwin = true ]; then
    SEP=";"
else
    SEP=":"
fi

#for i in `ls $JBOSS_HOME/client/*.jar`; do
#	JBOSS_CLASSPATH=$i${SEP}$JBOSS_CLASSPATH
#done

while [ "$1" != "" ]; do
    if [ "$1" = "-debug" ]; then
        if [ $cygwin = false ]; then
            JAVA_OPTS="-Xdebug -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=12348"
        else
            JAVA_OPTS="-Xdebug -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=dt_shmem,server=y,suspend=y,address=unittest"
        fi
    fi
    shift
done

REMOTING_LIB=$reldir/../../../thirdparty/jboss/remoting/lib/jboss-remoting.jar
#REMOTING_LIB=$reldir/../resources/jboss-remoting.jar

JGROUPS_LIB=$reldir/../../../thirdparty/jgroups/lib/jgroups.jar
#JGROUPS_LIB=$reldir/../resources/jgroups-core.jar


if [ "$TARGET_TEST" != "" ]; then
   TARGET_TEST="-t $TARGET_TEST"
fi


java $JAVA_OPTS -cp \
$reldir/../etc${SEP}\
$reldir/../../src/etc${SEP}\
$reldir/../output/classes${SEP}\
$reldir/../../output/classes${SEP}\
${REMOTING_LIB}${SEP}\
$reldir/../../../j2ee/output/lib/jboss-j2ee.jar${SEP}\
$reldir/../../../j2se/output/lib/jboss-j2se.jar${SEP}\
$reldir/../../../jmx/output/lib/jboss-jmx.jar${SEP}\
$reldir/../../../mbeans/output/lib/jboss-mbeans.jar${SEP}\
$reldir/../../../aop/output/lib/jboss-aop.jar${SEP}\
$reldir/../../../thirdparty/jboss/serialization/lib/jboss-serialization.jar${SEP}\
$reldir/../../../thirdparty/apache-log4j/lib/log4j.jar${SEP}\
$reldir/../../../thirdparty/apache-logging/lib/commons-logging.jar${SEP}\
$reldir/../../../thirdparty/junit/lib/junit.jar${SEP}\
$reldir/../../../thirdparty/oswego-concurrent/lib/concurrent.jar${SEP}\
$reldir/../../../thirdparty/javassist/lib/javassist.jar${SEP}\
$reldir/../../../thirdparty/trove/lib/trove.jar${SEP}\
$reldir/../../../thirdparty/apache-httpclient/lib/commons-httpclient.jar${SEP}\
$reldir/../../../thirdparty/dom4j/lib/dom4j.jar${SEP}\
$reldir/../../../thirdparty/sun-servlet/lib/servlet-api.jar${SEP}\
$reldir/../../../common/output/lib/jboss-common.jar${SEP}\
$reldir/../../../system/output/lib/jboss-system.jar${SEP}\
$reldir/../../../transaction/output/lib/jboss-transaction.jar${SEP}\
$reldir/../../../security/output/lib/jbosssx.jar${SEP}\
$reldir/../../src/resources/hsqldb.jar${SEP}\
$reldir/../../../connector/output/lib/jboss-local-jdbc.jar${SEP}\
$reldir/../../../connector/output/lib/jboss-common-jdbc-wrapper.jar${SEP}\
$reldir/../../../connector/output/lib/jboss-jca.jar${SEP}\
$reldir/../../../server/output/lib/jboss.jar${SEP}\
${JGROUPS_LIB}${SEP}\
 org.jboss.test.messaging.tools.junit.SelectiveTestRunner $TARGET_CLASS $TARGET_TEST
